<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>å¤§æŒæ«ƒå·¥å…·ç®± - ç³»çµ±ç™»å…¥</title>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-10 rounded-[3rem] shadow-2xl w-full max-w-sm text-center border-b-8 border-blue-600">
        <div class="text-5xl mb-6">ğŸ”</div>
        <h1 class="text-2xl font-black mb-2 text-slate-800 tracking-wider">å¤§æŒæ«ƒå·¥å…·ç®±</h1>
        <p class="text-slate-400 text-[10px] uppercase tracking-widest mb-8">Management System Login</p>
        
        <div class="space-y-3 mb-8">
            <input id="userId" type="text" placeholder="è«‹è¼¸å…¥æŒæ«ƒ ID" class="w-full border-2 border-slate-50 p-4 rounded-2xl text-center focus:border-blue-500 outline-none transition bg-slate-50 font-bold text-slate-700">
            <input id="password" type="password" placeholder="å¯†ç¢¼ (åˆå§‹ç‚º umbd)" class="w-full border-2 border-slate-50 p-4 rounded-2xl text-center focus:border-blue-500 outline-none transition bg-slate-50 font-bold text-slate-700">
        </div>
        
        <button onclick="login()" id="btnText" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-blue-700 transition shadow-lg shadow-blue-100">é€²å…¥ç³»çµ±</button>
        
        <div class="mt-8 flex flex-col gap-4">
            <button onclick="toggleModal('forgetModal', true)" class="text-slate-300 text-[10px] hover:text-blue-500 transition font-bold uppercase tracking-widest">å¿˜è¨˜å¯†ç¢¼ï¼Ÿé»æ­¤é‡ç½®</button>
            <button onclick="testEntry()" class="text-slate-200 text-[9px] hover:text-slate-400 transition italic">Dev Test Entry (Skip Login)</button>
        </div>
    </div>

    <div id="forgetModal" class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl">
            <h3 class="text-xl font-black mb-2">æ‰¾å›å¯†ç¢¼</h3>
            <p class="text-slate-400 text-[10px] mb-6 font-bold uppercase tracking-widest">Password Recovery</p>
            <input id="resetID" type="text" placeholder="æ‚¨çš„å¸³è™Ÿ ID" class="w-full border-2 border-slate-50 p-4 rounded-2xl mb-3 outline-none bg-slate-50">
            <input id="resetRecovery" type="text" placeholder="6 ä½æ•‘æ´ç¢¼" class="w-full border-2 border-slate-50 p-4 rounded-2xl mb-6 outline-none bg-slate-50 text-center font-mono font-bold text-blue-600">
            <div class="flex gap-3">
                <button onclick="toggleModal('forgetModal', false)" class="flex-1 py-4 text-slate-400 font-bold text-sm">å–æ¶ˆ</button>
                <button onclick="submitReset()" id="resetBtn" class="flex-1 bg-red-500 text-white py-4 rounded-2xl font-bold text-sm">ç¢ºèªé‡ç½®</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxyC96mO15fHbbG11IVoWr7c_F63xAGYpYAhANVZGlmyCS43k-Gud26S5fmsIO-mBwy/exec"; 

        function login() {
            const id = document.getElementById('userId').value.trim();
            const pwd = document.getElementById('password').value.trim();
            if(!id || !pwd) return alert("è«‹è¼¸å…¥ ID èˆ‡å¯†ç¢¼");

            const btn = document.getElementById('btnText');
            btn.innerText = "é©—è­‰ä¸­..."; btn.disabled = true;

            fetch(`${SCRIPT_URL}?userId=${id}&password=${pwd}`)
                .then(res => res.json())
                .then(res => {
                    if(res.success) {
                        sessionStorage.setItem('gameData', JSON.stringify(res));
                        location.href = "portal.html"; 
                    } else {
                        alert(res.msg);
                        btn.innerText = "é€²å…¥ç³»çµ±"; btn.disabled = false;
                    }
                }).catch(() => { alert("é€£ç·šå¤±æ•—"); btn.innerText = "é€²å…¥ç³»çµ±"; btn.disabled = false; });
        }

        function testEntry() {
            const testData = { success: true, user: { name: "æ¸¬è©¦å“¡", id: "test", role: "Admin", level: 10 }, activities: [], config: {}, isNewRecovery: true, recoveryCode: "TEST66" };
            sessionStorage.setItem('gameData', JSON.stringify(testData));
            location.href = "portal.html";
        }

        function submitReset() {
            const id = document.getElementById('resetID').value;
            const rec = document.getElementById('resetRecovery').value;
            fetch(`${SCRIPT_URL}?action=reset&userId=${id}&recovery=${rec}`)
                .then(res => res.json()).then(res => { alert(res.msg); if(res.success) location.reload(); });
        }

        function toggleModal(id, show) {
            document.getElementById(id).classList.toggle('hidden', !show);
            document.getElementById(id).classList.toggle('flex', show);
        }
    </script>
</body>
</html>
