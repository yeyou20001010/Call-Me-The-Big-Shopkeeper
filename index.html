<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>å¤§æŒæ«ƒå·¥å…·ç®± - ç™»å…¥</title>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-6">
    <div class="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl p-10 border border-slate-200">
        <div class="text-center mb-8">
            <div class="inline-block p-4 bg-indigo-600 rounded-2xl shadow-lg mb-4">
                <span class="text-3xl">ğŸ®</span>
            </div>
            <h1 class="text-2xl font-black text-slate-800">å¤§æŒæ«ƒå·¥å…·ç®±</h1>
            <p class="text-slate-400 text-sm font-bold tracking-widest">LOGIN SYSTEM</p>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-xs font-black text-slate-400 mb-2 ml-2">æŒæ«ƒ ID </label>
                <input id="userId" type="text" placeholder="è«‹è¼¸å…¥UserID" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500 font-bold transition-all">
            </div>
            <div>
                <label class="block text-xs font-black text-slate-400 mb-2 ml-2">å¯†ç¢¼ </label>
                <input id="password" type="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500 font-bold transition-all">
            </div>
            
            <button id="loginBtn" onclick="handleLogin()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-black py-4 rounded-2xl shadow-lg transition-all transform active:scale-95">é€²å…¥ç³»çµ±</button>
            
            <div class="flex justify-between px-2 text-xs font-bold text-slate-400">
                <button onclick="openResetModal()" class="hover:text-indigo-500 transition-colors">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</button>
                <button onclick="openChangeModal()" class="hover:text-indigo-500 transition-colors">ä¿®æ”¹å¯†ç¢¼</button>
            </div>
        </div>
    </div>

    <div id="msgModal" class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center z-[100] backdrop-blur-sm p-4">
        <div class="bg-white rounded-[2rem] p-8 max-w-xs w-full text-center shadow-2xl border border-slate-100">
            <div id="msgIcon" class="text-4xl mb-4">âš ï¸</div>
            <p id="msgText" class="text-slate-700 font-black text-lg mb-6"></p>
            <button onclick="closeMsg()" class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <div id="actionModal" class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center z-50 backdrop-blur-sm p-4">
        <div class="bg-white rounded-[2.5rem] p-8 max-w-sm w-full shadow-2xl">
            <h3 id="modalTitle" class="text-xl font-black text-slate-800 mb-2">æ¨™é¡Œ</h3>
            <p id="modalSub" class="text-xs text-slate-400 font-bold mb-6">æè¿°æ–‡å­—</p>
            <div id="modalInputs" class="space-y-4 mb-6"></div>
            <div class="flex gap-2">
                <button onclick="closeAction()" class="flex-1 py-4 bg-slate-100 text-slate-500 rounded-2xl font-black">å–æ¶ˆ</button>
                <button id="modalConfirmBtn" class="flex-1 py-4 bg-indigo-600 text-white rounded-2xl font-black shadow-lg">æäº¤</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxyC96mO15fHbbG11IVoWr7c_F63xAGYpYAhANVZGlmyCS43k-Gud26S5fmsIO-mBwy/exec";

        function showMsg(text, icon = "âš ï¸") {
            document.getElementById('msgIcon').innerText = icon;
            document.getElementById('msgText').innerText = text;
            document.getElementById('msgModal').classList.replace('hidden', 'flex');
        }
        function closeMsg() { document.getElementById('msgModal').classList.replace('flex', 'hidden'); }

        async function handleLogin() {
            const userId = document.getElementById('userId').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('loginBtn');

            if(!userId || !password) return showMsg("æ¬„ä½ä¸å¯ç‚ºç©º");

            btn.disabled = true;
            btn.innerText = "é©—è­‰ä¸­...";

            try {
                const response = await fetch(`${SCRIPT_URL}?userId=${userId}&password=${password}`);
                const data = await response.json();

                if (data.success) {
                    sessionStorage.setItem('gameData', JSON.stringify(data));
                    location.href = "portal.html";
                } else {
                    showMsg(data.msg, "âŒ");
                    btn.disabled = false;
                    btn.innerText = "é€²å…¥ç³»çµ±";
                }
            } catch (e) {
                showMsg("é€£ç·šç™¼ç”ŸéŒ¯èª¤");
                btn.disabled = false;
                btn.innerText = "é€²å…¥ç³»çµ±";
            }
        }

        // ä¿®æ”¹å¯†ç¢¼ UI
        function openChangeModal() {
            const container = document.getElementById('modalInputs');
            document.getElementById('modalTitle').innerText = "ä¿®æ”¹å¯†ç¢¼";
            document.getElementById('modalSub').innerText = "è«‹è¼¸å…¥èˆŠå¯†ç¢¼èˆ‡æ–°å¯†ç¢¼";
            container.innerHTML = `
                <input id="act_uid" type="text" placeholder="æŒæ«ƒ ID" class="w-full p-4 bg-slate-50 border rounded-2xl font-bold outline-none">
                <input id="act_old" type="password" placeholder="ç›®å‰å¯†ç¢¼" class="w-full p-4 bg-slate-50 border rounded-2xl font-bold outline-none">
                <input id="act_new" type="password" placeholder="æ–°å¯†ç¢¼" class="w-full p-4 bg-slate-50 border rounded-2xl font-bold outline-none">
            `;
            document.getElementById('modalConfirmBtn').onclick = submitChange;
            document.getElementById('actionModal').classList.replace('hidden', 'flex');
        }

        async function submitChange() {
            const uid = document.getElementById('act_uid').value;
            const oldP = document.getElementById('act_old').value;
            const newP = document.getElementById('act_new').value;
            if(!uid || !oldP || !newP) return showMsg("è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½");

            const res = await fetch(`${SCRIPT_URL}?action=changePassword&userId=${uid}&password=${oldP}&newPassword=${newP}`);
            const data = await res.json();
            showMsg(data.msg, data.success ? "âœ…" : "âŒ");
            if(data.success) closeAction();
        }

        // æ•‘æ´å¯†ç¢¼ UI
        function openResetModal() {
            const container = document.getElementById('modalInputs');
            document.getElementById('modalTitle').innerText = "é‡ç½®å¯†ç¢¼";
            document.getElementById('modalSub').innerText = "å¯†ç¢¼å°‡è¢«é‡è¨­ç‚º umbd";
            container.innerHTML = `
                <input id="act_uid" type="text" placeholder="æŒæ«ƒ ID" class="w-full p-4 bg-slate-50 border rounded-2xl font-bold outline-none">
                <input id="act_rec" type="text" placeholder="æ•‘æ´ç¢¼ (6ç¢¼)" class="w-full p-4 bg-slate-50 border rounded-2xl font-bold outline-none">
            `;
            document.getElementById('modalConfirmBtn').onclick = submitReset;
            document.getElementById('actionModal').classList.replace('hidden', 'flex');
        }

        async function submitReset() {
            const uid = document.getElementById('act_uid').value;
            const rec = document.getElementById('act_rec').value;
            const res = await fetch(`${SCRIPT_URL}?action=reset&userId=${uid}&recovery=${rec}`);
            const data = await res.json();
            showMsg(data.msg, data.success ? "âœ…" : "âŒ");
            if(data.success) closeAction();
        }

        function closeAction() { document.getElementById('actionModal').classList.replace('flex', 'hidden'); }
    </script>
</body>
</html>
