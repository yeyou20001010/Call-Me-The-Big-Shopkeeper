<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>ç³»çµ±ç™»å…¥</title>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-10 rounded-3xl shadow-2xl w-full max-w-sm text-center">
        <div class="text-5xl mb-6">ğŸ”</div>
        <h1 class="text-2xl font-bold mb-2 text-slate-800 tracking-wider">å¤§æŒæ«ƒå·¥å…·ç®±</h1>
        <p class="text-slate-400 text-xs mb-8">è«‹è¼¸å…¥æ‚¨çš„å¸³è™Ÿå¯†ç¢¼</p>
        
        <input id="userId" type="text" placeholder="æŒæ«ƒ ID" class="w-full border-2 border-slate-100 p-4 rounded-xl mb-3 text-center focus:border-blue-500 outline-none transition bg-slate-50">
        <input id="password" type="password" placeholder="å¯†ç¢¼ (åˆå§‹ç‚º umbd)" class="w-full border-2 border-slate-100 p-4 rounded-xl mb-6 text-center focus:border-blue-500 outline-none transition bg-slate-50">
        
        <button onclick="login()" id="btnText" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transition shadow-lg">ç™»å…¥ç³»çµ±</button>
        
        <button onclick="toggleModal('forgetModal', true)" class="mt-6 text-slate-400 text-xs hover:text-blue-500 transition">å¿˜è¨˜å¯†ç¢¼ï¼Ÿé»æ­¤é‡ç½®</button>
    </div>

    <div id="forgetModal" class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-3xl p-8 shadow-2xl">
            <h3 class="text-xl font-black mb-2">æ‰¾å›å¯†ç¢¼</h3>
            <p class="text-slate-400 text-xs mb-6">è¼¸å…¥ ID èˆ‡æ‚¨çš„æ•‘æ´ç¢¼ï¼Œå¯†ç¢¼å°‡é‚„åŸç‚º umbd</p>
            <input id="resetID" type="text" placeholder="æ‚¨çš„æŒæ«ƒ ID" class="w-full border border-slate-200 p-4 rounded-xl mb-3 outline-none">
            <input id="resetRecovery" type="text" placeholder="æ‚¨çš„ 6 ä½æ•‘æ´ç¢¼" class="w-full border border-slate-200 p-4 rounded-xl mb-6 outline-none">
            <div class="flex gap-2">
                <button onclick="toggleModal('forgetModal', false)" class="flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold">å–æ¶ˆ</button>
                <button onclick="submitReset()" id="resetBtn" class="flex-1 py-3 bg-red-500 text-white rounded-xl font-bold">ç¢ºèªé‡ç½®</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxyC96mO15fHbbG11IVoWr7c_F63xAGYpYAhANVZGlmyCS43k-Gud26S5fmsIO-mBwy/exec"; // <--- è¨˜å¾—å¡«å…¥

        function login() {
            const id = document.getElementById('userId').value;
            const pwd = document.getElementById('password').value;
            if(!id || !pwd) return alert("è«‹å®Œæ•´è¼¸å…¥ ID èˆ‡å¯†ç¢¼");

            const btn = document.getElementById('btnText');
            btn.innerText = "é©—è­‰ä¸­...";
            btn.disabled = true;

            fetch(`${SCRIPT_URL}?userId=${id}&password=${pwd}`)
                .then(res => res.json())
                .then(res => {
                    if(res.success) {
                        sessionStorage.setItem('gameData', JSON.stringify(res));
                        location.href = "portal.html"; 
                    } else {
                        alert("ç™»å…¥å¤±æ•—ï¼š" + res.msg);
                        btn.innerText = "ç™»å…¥ç³»çµ±"; btn.disabled = false;
                    }
                }).catch(() => { alert("ç¶²è·¯éŒ¯èª¤"); btn.innerText = "ç™»å…¥ç³»çµ±"; btn.disabled = false; });
        }

        function submitReset() {
            const id = document.getElementById('resetID').value;
            const rec = document.getElementById('resetRecovery').value;
            if(!id || !rec) return alert("è«‹è¼¸å…¥å®Œæ•´è³‡è¨Š");

            document.getElementById('resetBtn').innerText = "è™•ç†ä¸­...";
            fetch(`${SCRIPT_URL}?action=reset&userId=${id}&recovery=${rec}`)
                .then(res => res.json())
                .then(res => {
                    alert(res.msg);
                    if(res.success) location.reload();
                    else document.getElementById('resetBtn').innerText = "ç¢ºèªé‡ç½®";
                });
        }

        function toggleModal(id, show) {
            document.getElementById(id).classList.toggle('hidden', !show);
            document.getElementById(id).classList.toggle('flex', show);
        }
    </script>
</body>
</html>
