<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å¤§èˆªç·šï¼šç­–ç•¥æ±ºç­–ç³»çµ± v10</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root { --hpink: #FF9D6F; --mbg: #FBFBF9; --spurple: #5E548E; --gain-red: #E53935; --fgreen: #00897B; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #EAE8E4; color: #6D6875; }
        [v-cloak] { display: none; }
        .card-std { background: var(--mbg); border: 1px solid #D7D3CC; border-radius: 1rem; overflow: hidden; }
        
        /* çª„é•·è¼¸å…¥æ¡†ï¼šé«˜åº¦èˆ‡å­—é«”ä¸€è‡´ */
        .input-inline {
            background: #FFFFFF; border: 1px solid #D7D3CC; border-radius: 4px;
            padding: 0 6px; text-align: right; width: 100%; height: 26px;
            font-weight: 900; color: #5E548E; outline: none; font-size: 13px;
        }
        /* è¼”åŠ©é …ç›®çš„è¼¸å…¥æ¡† (æ¼²è·Œ%) å¯ä»¥æ›´æ·¡ä¸€é» */
        .input-aux { color: #94A3B8; font-weight: 500; }

        .text-gain { color: var(--gain-red); }
        .text-loss { color: var(--fgreen); }
    </style>
</head>
<body class="p-2 md:p-4">
    <div id="app" v-cloak class="max-w-[1200px] mx-auto pb-12">
        
        <div class="flex justify-between items-end mb-4 px-2">
            <div>
                <h1 class="text-xl font-black text-[#5E548E]">ğŸš¢ èˆªç·šæ±ºç­–ç³»çµ± <span class="text-xs opacity-40 font-normal">v10.0</span></h1>
                <p class="text-[10px] text-gray-400">é‚è¼¯ï¼šåˆ©æ½¤ç”±åˆ©å·®æ±ºå®šï¼Œæ¼²è·Œå¹…åƒ…ä¾›æ½›åŠ›é åˆ¤</p>
            </div>
            <div class="flex gap-2">
                <div class="bg-white px-2 py-1 rounded border text-[10px] font-bold">
                    å•†èˆ¹åŠ æˆ: <input type="number" v-model.number="globalBonus" class="w-8 text-center text-[#7B1FA2] outline-none">%
                </div>
                <button @click="resetAll" class="bg-gray-400 text-white px-2 py-1 rounded text-[10px] font-black">é‡ç½®</button>
            </div>
        </div>

        <div class="card-std p-3 mb-6 shadow-sm">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div v-for="(p, i) in products" :key="i" class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-base font-black text-[#5E548E]">{{ p.label }}</span>
                        <div v-if="p.bTrend !== null && p.sTrend !== null" 
                             :class="trendColor(p.sTrend - p.bTrend)" 
                             class="text-[10px] px-1.5 rounded-full border font-bold">
                             æ½›åŠ›: {{ (p.sTrend - p.bTrend) > 0 ? '+' : '' }}{{ p.sTrend - p.bTrend }}%
                        </div>
                    </div>
                    
                    <select v-model="p.name" class="w-full text-[10px] mb-2 border rounded p-0.5 text-gray-400">
                        <option value="">-- å¿«é€Ÿé¸æ“‡é …ç›® --</option>
                        <option v-for="opt in commonItems" :value="opt">{{ opt }}</option>
                    </select>

                    <div class="space-y-1 text-xs font-bold">
                        <div class="flex items-center gap-2">
                            <span class="w-12 text-gray-400">æˆæœ¬/%</span>
                            <div class="flex-1"><input type="number" v-model.number="p.bPrice" class="input-inline" placeholder="å”®åƒ¹"></div>
                            <div class="w-14"><input type="number" v-model.number="p.bTrend" class="input-inline input-aux" placeholder="%"></div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-12 text-gray-400">å”®åƒ¹/%</span>
                            <div class="flex-1"><input type="number" v-model.number="p.sPrice" class="input-inline" placeholder="å”®åƒ¹"></div>
                            <div class="w-14"><input type="number" v-model.number="p.sTrend" class="input-inline input-aux" placeholder="%"></div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-12 text-gray-400">æ•¸é‡</span>
                            <div class="flex-1"><input type="number" v-model.number="p.stock" class="input-inline"></div>
                        </div>
                    </div>

                    <div class="mt-2 pt-2 border-t flex justify-between items-end">
                        <div class="text-[10px]">
                            <div class="text-gray-400">åˆ©å·®: {{ (p.sPrice - p.bPrice) || 0 }}</div>
                            <div class="text-gray-400">ç›ˆè™§: {{ calcT0(p).rate }}%</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[9px] text-gray-400 leading-none">å¯¦æ‹¿æ·¨åˆ©</div>
                            <div class="text-base font-black text-[#7B1FA2] leading-tight">{{ format(calcT0(p).net) }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <div v-for="(tab, tIdx) in [t1, t2]" :key="tIdx" class="card-std p-3">
                <h3 class="font-black text-xs text-[#5E548E] mb-2">ã€è¡¨ {{tIdx+1}}ã€‘æ–¹æ¡ˆ{{tIdx===0?'ä¸€':'äºŒ'}}ç­–ç•¥åˆ†æ</h3>
                <div class="flex gap-2 mb-2">
                    <div class="flex-1 bg-white p-1 rounded border flex items-center justify-between">
                        <span class="text-[9px] text-gray-400">ç¸½è³‡:</span>
                        <input type="number" v-model.number="tab.fund" class="w-2/3 text-right text-xs font-black outline-none">
                    </div>
                    <div class="flex-1 bg-white p-1 rounded border flex items-center justify-between">
                        <span class="text-[9px] text-gray-400">ä¸»è€—:</span>
                        <input type="number" v-model.number="tab.minus" class="w-2/3 text-right text-xs font-black text-red-500 outline-none">
                    </div>
                </div>
                <table class="w-full table-fixed text-[11px]">
                    <thead class="text-gray-400 border-b font-black">
                        <tr>
                            <th class="w-12 text-left pb-1">é …ç›®</th>
                            <th class="w-20 text-right pb-1">ç›®çš„åœ°å”®åƒ¹</th>
                            <th class="w-16 text-right pb-1">å¯è²·æ•¸</th>
                            <th class="text-right pb-1">é ä¼°æ·¨åˆ©</th>
                        </tr>
                    </thead>
                    <tbody class="font-bold">
                        <tr v-for="(item, idx) in (tIdx===0 ? t1Items : t2Items)" class="border-b border-gray-50">
                            <td class="py-2 text-[#5E548E] truncate">{{ item.label }}</td>
                            <td><input type="number" v-model.number="tab.inputs[idx].sPrice" class="input-inline"></td>
                            <td class="text-right text-gray-400 px-1">{{ calcSub(tab, item, idx).qty }}</td>
                            <td class="text-right text-sm text-[#7B1FA2]">{{ format(calcSub(tab, item, idx).net) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    globalBonus: 12,
                    commonItems: ['èŠ±ç”Ÿ', 'åŸæœ¨', 'éµç¤¦', 'ç”Ÿçµ²', 'èŒ¶è‘‰', 'é¦™æ–™', 'èƒ¡æ¤’', 'ç´…å¯¶çŸ³'],
                    products: [
                        { label: 'ç‰¹ç”¢', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 1', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 2', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 }
                    ],
                    t1: { fund: null, minus: null, inputs: [{ sPrice: null }, { sPrice: null }] },
                    t2: { fund: null, minus: null, inputs: [{ sPrice: null }, { sPrice: null }] }
                }
            },
            computed: {
                t1Items() { return [this.products[1], this.products[2]]; },
                t2Items() { 
                    const marginRank = [...this.products].sort((a,b) => (b.sPrice-b.bPrice)/b.bPrice - (a.sPrice-a.bPrice)/a.bPrice)[0];
                    return this.products.filter(p => p.label !== marginRank.label);
                }
            },
            methods: {
                calcT0(p) {
                    if(!p.bPrice || !p.sPrice) return { rate: 0, net: 0 };
                    const diff = p.sPrice - p.bPrice;
                    const bonus = 1 + (this.globalBonus / 100);
                    return {
                        rate: Math.round((diff / p.bPrice) * 100),
                        net: diff * Math.floor(p.stock || 0) * bonus
                    };
                },
                calcSub(tab, pBase, idx) {
                    const remain = (tab.fund || 0) - (tab.minus || 0);
                    const sPrice = tab.inputs[idx].sPrice;
                    if (!pBase.bPrice || !sPrice || remain <= 0) return { qty: 0, net: 0 };
                    const qty = Math.floor(remain / pBase.bPrice);
                    const bonus = 1 + (this.globalBonus / 100);
                    return { qty, net: (sPrice - pBase.bPrice) * qty * bonus };
                },
                trendColor(gap) {
                    if (gap > 15) return 'bg-red-50 text-red-600 border-red-200';
                    if (gap < 0) return 'bg-green-50 text-green-600 border-green-200';
                    return 'bg-gray-50 text-gray-600 border-gray-200';
                },
                format(v) { return Math.floor(v || 0).toLocaleString(); },
                resetAll() { if(confirm("ç¢ºå®šæ¸…ç©ºï¼Ÿ")) Object.assign(this.$data, this.$options.data()); }
            }
        }).mount('#app');
    </script>
</body>
</html>
