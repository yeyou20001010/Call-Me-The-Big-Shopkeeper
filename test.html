<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å¤§èˆªç·šæ±ºç­– v15</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root { --hpink: #FF9D6F; --mbg: #FBFBF9; --spurple: #5E548E; --gain-red: #E53935; --fgreen: #00897B; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #EAE8E4; color: #6D6875; }
        [v-cloak] { display: none; }
        .card-std { background: var(--mbg); border: 1px solid #D7D3CC; border-radius: 1rem; overflow: hidden; }
        .input-inline {
            background: #FFFFFF; border: 1px solid #D7D3CC; border-radius: 4px;
            padding: 0 4px; text-align: right; height: 28px;
            font-weight: 900; color: #5E548E; outline: none; font-size: 13px;
        }
        .text-gain { color: var(--gain-red); }
        .text-loss { color: var(--fgreen); }
        .row-label { font-size: 12px; color: #94A3B8; font-weight: bold; }
    </style>
</head>
<body class="p-2 md:p-4">
    <div id="app" v-cloak>
        <div class="max-w-[1200px] mx-auto mb-4 flex justify-between items-center px-2">
            <div class="flex items-center gap-3">
                <h1 class="text-xl font-black text-[#5E548E]">ğŸš¢ æ™ºæ…§æ±ºç­–ç³»çµ±</h1>
                <div class="bg-slate-700 px-3 py-1 rounded-full flex items-center gap-2 border border-slate-500 shadow-md">
                    <span class="text-[10px] text-white font-bold">ç¾æœ‰ç¸½è³‡é‡‘:</span>
                    <input type="number" v-model.number="totalFund" class="bg-transparent border-b border-yellow-400 w-24 text-right font-black outline-none text-yellow-400">
                </div>
            </div>
            <button @click="resetAll" class="bg-red-400 text-white px-3 py-1 rounded-lg text-xs font-bold shadow hover:bg-red-500">å…¨éƒ¨æ¸…é™¤</button>
        </div>

        <div class="max-w-[1200px] mx-auto card-std p-4 mb-6 shadow-sm border-t-4 border-slate-500">
            <div class="flex gap-2 mb-4 border-b pb-3">
                <div class="bg-orange-500 text-white px-3 py-1 rounded text-xs font-black">ğŸ† æ¯›åˆ©ç‹ï¼š{{ getRankLabels().margin }}</div>
                <div class="bg-purple-600 text-white px-3 py-1 rounded text-xs font-black">ğŸ’° æ·¨åˆ©ç‹ï¼š{{ getRankLabels().net }}</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div v-for="(p, i) in products" :key="i" class="bg-white p-4 rounded-xl border border-gray-200">
                    <div class="flex justify-between items-center mb-4 border-b pb-1">
                        <span class="text-lg font-black text-[#5E548E]">{{ p.label }}</span>
                        <input v-model="p.name" class="w-20 text-right text-xs text-gray-400 outline-none" placeholder="å“å">
                    </div>

                    <div class="space-y-3">
                        <div class="grid grid-cols-12 items-center gap-2">
                            <span class="col-span-2 row-label">æˆæœ¬</span>
                            <input type="number" v-model.number="p.bPrice" class="col-span-5 input-inline">
                            <span class="col-span-2 row-label text-center">æ¼²å¹…</span>
                            <input type="number" v-model.number="p.bTrend" :class="p.bTrend >= 0 ? 'text-gain' : 'text-loss'" class="col-span-3 input-inline">
                        </div>
                        <div class="grid grid-cols-12 items-center gap-2">
                            <span class="col-span-3 row-label">å¯è²·æ•¸é‡</span>
                            <div class="col-span-9 input-inline flex items-center justify-end text-slate-400">
                                <span class="text-[10px] mr-auto">åº«å­˜:</span>
                                <input type="number" v-model.number="p.stock" class="w-full text-right outline-none text-[#5E548E]">
                            </div>
                        </div>
                        <div class="grid grid-cols-12 items-center gap-2">
                            <span class="col-span-2 row-label">å”®åƒ¹</span>
                            <input type="number" v-model.number="p.sPrice" class="col-span-5 input-inline">
                            <span class="col-span-2 row-label text-center">æ¼²å¹…</span>
                            <input type="number" v-model.number="p.sTrend" :class="p.sTrend >= 0 ? 'text-gain' : 'text-loss'" class="col-span-3 input-inline">
                        </div>
                        <div class="grid grid-cols-12 items-center gap-2 pt-1 border-t border-gray-50">
                            <span class="col-span-2 row-label">ç›ˆè™§</span>
                            <div class="col-span-5 text-right font-black text-xs" :class="colorScale(calcT0(p).rate)">{{ calcT0(p).rate }}%</div>
                            <span class="col-span-2 row-label text-center">é åˆ¤</span>
                            <div class="col-span-3 text-right font-black text-xs" :class="colorScale(p.sTrend - p.bTrend)">{{ p.sTrend - p.bTrend }}%</div>
                        </div>
                    </div>

                    <div class="mt-4 pt-3 border-t-2 border-dashed flex justify-between items-end">
                        <div class="flex flex-col">
                            <span class="text-[9px] text-gray-400 font-bold">å–®ä»¶æ¯›åˆ©</span>
                            <span class="text-sm font-black text-slate-600">{{ format(calcT0(p).margin) }}</span>
                        </div>
                        <div class="text-right">
                            <span class="text-[9px] text-purple-400 font-bold">é ä¼°ç¸½æ·¨åˆ©</span>
                            <div class="text-xl font-black text-[#7B1FA2]">{{ format(calcT0(p).net) }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-[1200px] mx-auto grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <div class="card-std p-4 border-t-4 border-orange-400 shadow">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-black text-sm text-[#5E548E]">æ–¹æ¡ˆä¸€ï¼šç‰¹ç”¢å„ªå…ˆç­–ç•¥</h3>
                    <div class="text-[10px] font-bold bg-white px-2 py-1 rounded border">è€—è³‡è£œæ‰£ï¼š<input type="number" v-model.number="t1Minus" class="w-12 text-right outline-none"></div>
                </div>
                <table class="w-full text-[11px] font-bold">
                    <thead class="text-gray-400 border-b text-right">
                        <tr><th class="text-left py-1">å“å</th><th>é è¨ˆå”®åƒ¹</th><th>æ•¸é‡</th><th>æ·¨åˆ©</th></tr>
                    </thead>
                    <tbody class="text-right">
                        <tr v-for="(p, idx) in [products[1], products[2]]" :key="idx" class="border-b border-gray-50">
                            <td class="py-2 text-left">{{ p.label }}</td>
                            <td><input type="number" v-model.number="t1Inputs[idx].sPrice" class="input-inline w-20"></td>
                            <td class="text-gray-400">{{ calcSub(p, t1Inputs[idx].sPrice, products[0]).qty }}</td>
                            <td class="text-[#7B1FA2]">{{ format(calcSub(p, t1Inputs[idx].sPrice, products[0]).net) }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="mt-4 text-right font-black text-orange-600">æ–¹æ¡ˆç¸½æ”¶ç›Šï¼š{{ format(getT1Total()) }}</div>
            </div>

            <div class="card-std p-4 border-t-4 border-purple-500 shadow">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-black text-sm text-[#5E548E]">æ–¹æ¡ˆäºŒï¼šæ¯›åˆ©ç‹å„ªå…ˆç­–ç•¥</h3>
                    <div class="text-[10px] font-bold bg-white px-2 py-1 rounded border">è€—è³‡è£œæ‰£ï¼š<input type="number" v-model.number="t2Minus" class="w-12 text-right outline-none"></div>
                </div>
                <table class="w-full text-[11px] font-bold">
                    <thead class="text-gray-400 border-b text-right">
                        <tr><th class="text-left py-1">å“å</th><th>é è¨ˆå”®åƒ¹</th><th>æ•¸é‡</th><th>æ·¨åˆ©</th></tr>
                    </thead>
                    <tbody class="text-right">
                        <tr v-for="(p, idx) in getT2List()" :key="idx" class="border-b border-gray-50">
                            <td class="py-2 text-left">{{ p.label }}</td>
                            <td><input type="number" v-model.number="t2Inputs[idx].sPrice" class="input-inline w-20"></td>
                            <td class="text-gray-400">{{ calcSub(p, t2Inputs[idx].sPrice, getMarginKingObj()).qty }}</td>
                            <td class="text-[#7B1FA2]">{{ format(calcSub(p, t2Inputs[idx].sPrice, getMarginKingObj()).net) }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="mt-4 text-right font-black text-purple-600">æ–¹æ¡ˆç¸½æ”¶ç›Šï¼š{{ format(getT2Total()) }}</div>
            </div>
        </div>

        <div class="max-w-[1200px] mx-auto card-std p-5 bg-slate-800 text-white shadow-xl">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex-1">
                    <div class="text-yellow-400 font-black text-lg mb-1">ğŸ’¡ æ±ºç­–åˆ†æ</div>
                    <p class="text-xs text-slate-300 leading-relaxed">{{ getDecision() }}</p>
                </div>
                <div class="text-right border-l border-slate-700 pl-6">
                    <div class="text-[10px] text-slate-400 font-bold uppercase mb-1">æœ¬æ¬¡æœ€å¤§æ”¶ç›Š</div>
                    <div class="text-3xl font-black text-white">{{ format(getMaxProfit()) }}</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    totalFund: 100000,
                    globalBonus: 12,
                    t1Minus: 0, t2Minus: 0,
                    products: [
                        { label: 'ç‰¹ç”¢', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 1', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 2', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 }
                    ],
                    t1Inputs: [{ sPrice: null }, { sPrice: null }],
                    t2Inputs: [{ sPrice: null }, { sPrice: null }]
                }
            },
            methods: {
                // é€šç”¨è¨ˆç®—
                calcT0(p) {
                    if (!p.bPrice || !p.sPrice) return { margin: 0, net: 0, rate: 0, qty: 0 };
                    const diff = p.sPrice - p.bPrice;
                    const bonus = 1 + (this.globalBonus / 100);
                    const qty = Math.min(Math.floor(p.stock || 0), Math.floor(this.totalFund / p.bPrice));
                    return {
                        margin: diff * bonus,
                        net: diff * qty * bonus,
                        rate: Math.round((diff / p.bPrice) * 100),
                        qty: qty
                    };
                },
                calcSub(targetP, inputS, lockP) {
                    if (!targetP.bPrice || !inputS || !lockP.bPrice) return { qty: 0, net: 0 };
                    const lockQty = this.calcT0(lockP).qty;
                    const remain = this.totalFund - (lockQty * lockP.bPrice) - (this.t1Minus || 0);
                    if (remain <= 0) return { qty: 0, net: 0 };
                    const qty = Math.floor(remain / targetP.bPrice);
                    const net = (inputS - targetP.bPrice) * qty * (1 + this.globalBonus/100);
                    return { qty, net };
                },
                // ç²å–æ•¸æ“šå°è±¡
                getMarginKingObj() {
                    let best = this.products[0];
                    let maxR = -999;
                    this.products.forEach(p => {
                        const r = p.bPrice ? (p.sPrice - p.bPrice) / p.bPrice : -999;
                        if (r > maxR) { maxR = r; best = p; }
                    });
                    return best;
                },
                getRankLabels() {
                    let mLabel = '---', nLabel = '---', maxR = -999, maxN = -999;
                    this.products.forEach(p => {
                        const res = this.calcT0(p);
                        if (res.rate > maxR && p.bPrice) { maxR = res.rate; mLabel = p.label; }
                        if (res.net > maxN && p.bPrice) { maxN = res.net; nLabel = p.label; }
                    });
                    return { margin: mLabel, net: nLabel };
                },
                getT2List() {
                    const mk = this.getMarginKingObj();
                    return this.products.filter(p => p.label !== mk.label);
                },
                getT1Total() {
                    const p0Net = this.calcT0(this.products[0]).net;
                    const subNets = [
                        this.calcSub(this.products[1], this.t1Inputs[0].sPrice, this.products[0]).net,
                        this.calcSub(this.products[2], this.t1Inputs[1].sPrice, this.products[0]).net
                    ];
                    return p0Net + Math.max(0, ...subNets);
                },
                getT2Total() {
                    const mk = this.getMarginKingObj();
                    const mkNet = this.calcT0(mk).net;
                    const list = this.getT2List();
                    const subNets = [
                        this.calcSub(list[0], this.t2Inputs[0].sPrice, mk).net,
                        this.calcSub(list[1], this.t2Inputs[1].sPrice, mk).net
                    ];
                    return mkNet + Math.max(0, ...subNets);
                },
                getMaxProfit() { return Math.max(this.getT1Total(), this.getT2Total(), 0); },
                getDecision() {
                    if (!this.products[0].bPrice) return "è«‹è¼¸å…¥ç‰¹ç”¢å ±åƒ¹ä»¥é–‹å§‹ã€‚";
                    const t1 = this.getT1Total();
                    const t2 = this.getT2Total();
                    if (t1 >= t2) return "å»ºè­°ã€æ–¹æ¡ˆä¸€ã€‘ï¼šç‰¹ç”¢åŸºæ•¸å¤§ï¼Œå…ˆè²·æ»¿ç‰¹ç”¢å†é…å‰¯ç”¢åˆ©æ½¤æœ€ç©©ã€‚";
                    return `å»ºè­°ã€æ–¹æ¡ˆäºŒã€‘ï¼šå„ªå…ˆè²·æ»¿æ•ˆç‡æœ€é«˜çš„ã€Œ${this.getMarginKingObj().label}ã€ï¼Œç¸½æ”¶ç›Šæ›´é«˜ã€‚`;
                },
                format(v) { return Math.floor(v || 0).toLocaleString(); },
                colorScale(v) { return v > 0 ? 'text-gain' : (v < 0 ? 'text-loss' : 'text-gray-400'); },
                resetAll() { if(confirm("ç¢ºå®šé‡ç½®æ‰€æœ‰æ•¸æ“šï¼Ÿ")) location.reload(); }
            }
        }).mount('#app');
    </script>
</body>
</html>
