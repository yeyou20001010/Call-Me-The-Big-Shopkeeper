<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å¤§èˆªç·šï¼šæ±ºç­–ç³»çµ± v11</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root { --hpink: #FF9D6F; --mbg: #FBFBF9; --spurple: #5E548E; --gain-red: #E53935; --fgreen: #00897B; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #EAE8E4; color: #6D6875; }
        [v-cloak] { display: none; }
        .card-std { background: var(--mbg); border: 1px solid #D7D3CC; border-radius: 1rem; overflow: hidden; }
        .input-inline {
            background: #FFFFFF; border: 1px solid #D7D3CC; border-radius: 4px;
            padding: 0 4px; text-align: right; height: 26px;
            font-weight: 900; color: #5E548E; outline: none; font-size: 13px;
        }
        .text-gain { color: var(--gain-red); }
        .text-loss { color: var(--fgreen); }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body class="p-2 md:p-4">
    <div id="app" v-cloak class="max-w-[1200px] mx-auto pb-12">
        
        <div class="flex justify-between items-center mb-4 px-2 no-print">
            <div class="flex gap-2">
                <button @click="backToMenu" class="bg-gray-600 text-white px-3 py-1 rounded-lg text-xs font-bold">â¬… è¿”å›é¸å–®</button>
                <button @click="saveData" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-xs font-bold">ğŸ’¾ æš«å­˜æ•¸æ“š</button>
            </div>
            <div class="flex gap-2">
                <button @click="takeScreenshot" class="bg-indigo-500 text-white px-3 py-1 rounded-lg text-xs font-bold">ğŸ“¸ æº–å‚™æˆªåœ–</button>
                <button @click="resetAll" class="bg-red-400 text-white px-3 py-1 rounded-lg text-xs font-bold">ğŸ—‘ï¸ å…¨éƒ¨æ¸…é™¤</button>
            </div>
        </div>

        <div class="flex justify-between items-end mb-4 px-2">
            <div>
                <h1 class="text-xl font-black text-[#5E548E]">ğŸš¢ èˆªç·šæŠ•è³‡æ±ºç­–ç³»çµ±</h1>
                <div class="flex gap-4 mt-1">
                    <span class="text-[11px] font-bold bg-orange-100 text-orange-600 px-2 py-0.5 rounded">æ¯›åˆ©ç‹ï¼š{{ rankMargin.label }}</span>
                    <span class="text-[11px] font-bold bg-purple-100 text-purple-600 px-2 py-0.5 rounded">æ·¨åˆ©ç‹ï¼š{{ rankNet.label }}</span>
                </div>
            </div>
            <div class="bg-white px-2 py-1 rounded border text-[10px] font-bold no-print">
                å•†èˆ¹åŠ æˆ: <input type="number" v-model.number="globalBonus" class="w-8 text-center text-[#7B1FA2] outline-none">%
            </div>
        </div>

        <div class="card-std p-3 mb-6 shadow-sm">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div v-for="(p, i) in products" :key="i" class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-center mb-3 border-b pb-1">
                        <span class="text-base font-black text-[#5E548E]">{{ p.label }}</span>
                        <input v-model="p.name" class="w-20 text-right text-xs text-gray-400 outline-none" placeholder="å“å">
                    </div>
                    
                    <div class="space-y-2 text-xs font-bold">
                        <div class="grid grid-cols-12 items-center gap-1">
                            <span class="col-span-2 text-gray-400">æˆæœ¬</span>
                            <input type="number" v-model.number="p.bPrice" class="col-span-5 input-inline">
                            <span class="col-span-2 text-center text-gray-400">æ¼²è·Œ</span>
                            <input type="number" v-model.number="p.bTrend" :class="p.bTrend > 0 ? 'text-gain' : 'text-loss'" class="col-span-3 input-inline">
                        </div>
                        <div class="grid grid-cols-12 items-center gap-1">
                            <span class="col-span-2 text-gray-400">å”®åƒ¹</span>
                            <input type="number" v-model.number="p.sPrice" class="col-span-5 input-inline">
                            <span class="col-span-2 text-center text-gray-400">æ¼²è·Œ</span>
                            <input type="number" v-model.number="p.sTrend" :class="p.sTrend > 0 ? 'text-gain' : 'text-loss'" class="col-span-3 input-inline">
                        </div>
                        <div class="grid grid-cols-12 items-center gap-1">
                            <span class="col-span-2 text-gray-400">åº«å­˜</span>
                            <input type="number" v-model.number="p.stock" class="col-span-10 input-inline">
                        </div>
                    </div>

                    <div class="mt-4 pt-2 border-t-2 border-dashed flex justify-between items-end">
                        <div class="text-[10px]">
                            <div class="font-bold" :class="trendColor(p.sTrend - p.bTrend)">é åˆ¤æ½›åŠ›: {{ (p.sTrend - p.bTrend) > 0 ? '+' : '' }}{{ p.sTrend - p.bTrend }}%</div>
                            <div class="text-gray-400">å–®ä»¶ç›ˆè™§: {{ calcT0(p).rate }}%</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[9px] text-gray-400">é ä¼°ç¸½æ·¨åˆ©</div>
                            <div class="text-lg font-black text-[#7B1FA2]">{{ format(calcT0(p).net) }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <div class="card-std p-4 border-t-4 border-orange-400 shadow-md">
                <h3 class="font-black text-sm text-[#5E548E]">ã€æ–¹æ¡ˆä¸€ã€‘ç‰¹ç”¢å„ªå…ˆç­–ç•¥</h3>
                <p class="text-[10px] text-gray-400 mb-3">æ€ç¶­ï¼šè²·ç©ºã€Œç‰¹ç”¢ã€å¾Œï¼Œå‰©é¤˜è³‡é‡‘æŠ•å…¥å‰¯ç”¢ç‰©</p>
                <div class="flex gap-2 mb-3 no-print">
                    <div class="flex-1 bg-white p-1 rounded border flex items-center justify-between">
                        <span class="text-[9px] text-gray-400 font-bold ml-1">ç¸½è³‡ç”¢:</span>
                        <input type="number" v-model.number="t1.fund" class="w-2/3 text-right text-xs font-black outline-none">
                    </div>
                    <div class="flex-1 bg-white p-1 rounded border flex items-center justify-between">
                        <span class="text-[9px] text-gray-400 font-bold ml-1">è²·ç©ºè€—è³‡:</span>
                        <input type="number" v-model.number="t1.minus" class="w-2/3 text-right text-xs font-black text-red-500 outline-none">
                    </div>
                </div>
                <table class="w-full text-[11px] font-bold">
                    <thead class="text-gray-400 border-b">
                        <tr>
                            <th class="text-left py-1">å“å</th>
                            <th class="text-right">é è¨ˆå”®åƒ¹</th>
                            <th class="text-right">é åˆ¤%</th>
                            <th class="text-right">æ•¸é‡</th>
                            <th class="text-right">é ä¼°æ·¨åˆ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, idx) in t1Items" class="border-b border-gray-50">
                            <td class="py-2 text-[#5E548E]">{{ item.label }}</td>
                            <td><input type="number" v-model.number="t1.inputs[idx].sPrice" class="input-inline w-16 float-right"></td>
                            <td><input type="number" v-model.number="t1.inputs[idx].sTrend" class="input-inline w-12 float-right text-gray-400"></td>
                            <td class="text-right text-gray-400">{{ calcSub(t1, item, idx).qty }}</td>
                            <td class="text-right text-[#7B1FA2] text-sm">{{ format(calcSub(t1, item, idx).net) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card-std p-4 border-t-4 border-purple-500 shadow-md">
                <h3 class="font-black text-sm text-[#5E548E]">ã€æ–¹æ¡ˆäºŒã€‘æ¯›åˆ©ç‹å„ªå…ˆç­–ç•¥</h3>
                <p class="text-[10px] text-gray-400 mb-3">æ€ç¶­ï¼šè²·ç©ºã€Œ{{ rankMargin.label }}ã€å¾Œï¼Œå‰©é¤˜è³‡é‡‘æŠ•å…¥å…¶ä»–</p>
                <div class="flex gap-2 mb-3 no-print">
                    <div class="flex-1 bg-white p-1 rounded border flex items-center justify-between">
                        <span class="text-[9px] text-gray-400 font-bold ml-1">ç¸½è³‡ç”¢:</span>
                        <input type="number" v-model.number="t2.fund" class="w-2/3 text-right text-xs font-black outline-none">
                    </div>
                    <div class="flex-1 bg-white p-1 rounded border flex items-center justify-between">
                        <span class="text-[9px] text-gray-400 font-bold ml-1">è²·ç©ºè€—è³‡:</span>
                        <input type="number" v-model.number="t2.minus" class="w-2/3 text-right text-xs font-black text-red-500 outline-none">
                    </div>
                </div>
                <table class="w-full text-[11px] font-bold">
                    <thead class="text-gray-400 border-b">
                        <tr>
                            <th class="text-left py-1">å“å</th>
                            <th class="text-right">é è¨ˆå”®åƒ¹</th>
                            <th class="text-right">é åˆ¤%</th>
                            <th class="text-right">æ•¸é‡</th>
                            <th class="text-right">é ä¼°æ·¨åˆ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, idx) in t2Items" class="border-b border-gray-50">
                            <td class="py-2 text-[#5E548E]">{{ item.label }}</td>
                            <td><input type="number" v-model.number="t2.inputs[idx].sPrice" class="input-inline w-16 float-right"></td>
                            <td><input type="number" v-model.number="t2.inputs[idx].sTrend" class="input-inline w-12 float-right text-gray-400"></td>
                            <td class="text-right text-gray-400">{{ calcSub(t2, item, idx).qty }}</td>
                            <td class="text-right text-[#7B1FA2] text-sm">{{ format(calcSub(t2, item, idx).net) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card-std p-6 bg-slate-800 text-white border-none shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 right-0 p-8 opacity-10">ğŸš¢</div>
            <div class="relative z-10 flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="text-center md:text-left">
                    <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-1">ç³»çµ±æ¨è–¦åŸ·è¡Œ</div>
                    <div class="text-2xl font-black text-yellow-400 mb-1">{{ finalDecision.title }}</div>
                    <p class="text-xs text-slate-300">{{ finalDecision.reason }}</p>
                </div>
                <div class="h-16 w-px bg-slate-700 hidden md:block"></div>
                <div class="text-center md:text-right">
                    <div class="text-xs text-slate-400 font-bold mb-1">æœ¬èˆªæ¬¡æœ€é«˜é ä¼°æ”¶ç›Š</div>
                    <div class="text-4xl font-black text-white">{{ format(maxTotalNet) }}</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    globalBonus: 12,
                    products: [
                        { label: 'ç‰¹ç”¢', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 1', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 2', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 }
                    ],
                    t1: { fund: null, minus: null, inputs: [{ sPrice: null, sTrend: 0 }, { sPrice: null, sTrend: 0 }] },
                    t2: { fund: null, minus: null, inputs: [{ sPrice: null, sTrend: 0 }, { sPrice: null, sTrend: 0 }] }
                }
            },
            mounted() {
                const saved = localStorage.getItem('sailingData');
                if (saved) Object.assign(this.$data, JSON.parse(saved));
            },
            computed: {
                rankMargin() { 
                    return [...this.products].sort((a,b) => {
                        const ra = a.bPrice ? (a.sPrice - a.bPrice)/a.bPrice : -99;
                        const rb = b.bPrice ? (b.sPrice - b.bPrice)/b.bPrice : -99;
                        return rb - ra;
                    })[0];
                },
                rankNet() { return [...this.products].sort((a,b) => this.calcT0(b).net - this.calcT0(a).net)[0]; },
                t1Items() { return [this.products[1], this.products[2]]; },
                t2Items() { return this.products.filter(p => p.label !== this.rankMargin.label); },
                t1TotalNet() {
                    const subNets = this.t1Items.map((item, idx) => this.calcSub(this.t1, item, idx).net);
                    return this.calcT0(this.products[0]).net + Math.max(...subNets);
                },
                t2TotalNet() {
                    const subNets = this.t2Items.map((item, idx) => this.calcSub(this.t2, item, idx).net);
                    return this.calcT0(this.rankMargin).net + Math.max(...subNets);
                },
                maxTotalNet() { return Math.max(this.t1TotalNet, this.t2TotalNet, ...this.products.map(p => this.calcT0(p).net)); },
                finalDecision() {
                    if (!this.products[0].bPrice) return { title: "ç­‰å¾…æ•¸æ“šä¸­", reason: "è«‹è‡³å°‘è¼¸å…¥ç‰¹ç”¢çš„æˆæœ¬èˆ‡å”®åƒ¹" };
                    if (this.t1TotalNet >= this.t2TotalNet && this.t1TotalNet > this.calcT0(this.rankNet).net) {
                        return { title: "åŸ·è¡Œæ–¹æ¡ˆä¸€", reason: "è²·ç©ºç‰¹ç”¢å¾Œï¼Œé…æ­å‰¯ç”¢å¯ç²å¾—æœ€å¤§åŒ–ç¸½åˆ©æ½¤" };
                    } else if (this.t2TotalNet > this.t1TotalNet) {
                        return { title: "åŸ·è¡Œæ–¹æ¡ˆäºŒ", reason: `è²·ç©º ${this.rankMargin.label} çš„æ•ˆç‡æ¥µé«˜ï¼Œå„ªæ–¼ç‰¹ç”¢çµ„åˆ` };
                    } else {
                        return { title: `ç›´æ¥è²·ç©º ${this.rankNet.label}`, reason: "ç•¶å‰è³‡é‡‘èˆ‡åƒ¹æ ¼é…ç½®ä¸‹ï¼Œå–®ä¸€æƒè²¨åˆ©æ½¤æœ€ç©©å®š" };
                    }
                }
            },
            methods: {
                calcT0(p) {
                    if(!p.bPrice || !p.sPrice) return { rate: 0, net: 0 };
                    const diff = p.sPrice - p.bPrice;
                    const bonus = 1 + (this.globalBonus / 100);
                    return { rate: Math.round((diff / p.bPrice) * 100), net: diff * Math.floor(p.stock || 0) * bonus };
                },
                calcSub(tab, pBase, idx) {
                    const remain = (tab.fund || 0) - (tab.minus || 0);
                    const sPrice = tab.inputs[idx].sPrice;
                    if (!pBase.bPrice || !sPrice || remain <= 0) return { qty: 0, net: 0 };
                    const qty = Math.floor(remain / pBase.bPrice);
                    const bonus = 1 + (this.globalBonus / 100);
                    return { qty, net: (sPrice - pBase.bPrice) * qty * bonus };
                },
                trendColor(gap) {
                    if (gap > 0) return 'text-gain';
                    if (gap < 0) return 'text-loss';
                    return 'text-gray-400';
                },
                format(v) { return Math.floor(v || 0).toLocaleString(); },
                resetAll() { if(confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰æ•¸æ“šï¼Ÿ")) { localStorage.removeItem('sailingData'); location.reload(); } },
                saveData() { localStorage.setItem('sailingData', JSON.stringify(this.$data)); alert('æ•¸æ“šå·²æš«å­˜è‡³ç€è¦½å™¨ï¼'); },
                backToMenu() { if(confirm("ç¢ºå®šè¿”å›é¸å–®ï¼Ÿæœªæš«å­˜æ•¸æ“šå°‡éºå¤±")) window.location.href = 'index.html'; },
                takeScreenshot() { alert('è«‹ä½¿ç”¨æ‰‹æ©Ÿå…§å»ºæˆªåœ–åŠŸèƒ½ï¼Œæˆ–æŒ‰ä¸‹ Ctrl+P å­˜ç‚º PDFã€‚ç›®å‰å·²ç‚ºæ‚¨éš±è—éå¿…è¦çš„æŒ‰éˆ•ã€‚'); }
            }
        }).mount('#app');
    </script>
</body>
</html>
