<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å¤§èˆªç·šï¼šç²¾æº–æ±ºç­–ç³»çµ± v9.0</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root { --hpink: #FF9D6F; --mbg: #FBFBF9; --spurple: #5E548E; --fgreen: #00897B; --gain-red: #E53935; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #EAE8E4; color: #6D6875; }
        [v-cloak] { display: none; }
        .card-std { background: var(--mbg); border: 1px solid #D7D3CC; border-radius: 1.25rem; overflow: hidden; }
        .input-slim {
            background: #FFFFFF; border: 1px solid #D7D3CC; border-radius: 4px;
            padding: 0 6px; text-align: right; width: 100%; height: 26px;
            font-weight: 900; color: #5E548E; outline: none; font-size: 13px;
        }
    </style>
</head>
<body class="p-2 md:p-4">
    <div id="app" v-cloak class="max-w-[1200px] mx-auto pb-12">
        
        <div class="flex justify-between items-center mb-4 px-2">
            <div>
                <h1 class="text-xl font-black text-[#5E548E]">ğŸš¢ ç²¾æº–èˆªç·šæ±ºç­–ç³»çµ±</h1>
                <p class="text-[10px] text-gray-500">å·²æ ¡æ­£ï¼šåˆ©æ½¤ = åˆ©å·® Ã— æ•¸é‡ Ã— å•†èˆ¹åŠ æˆ</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="bg-white px-3 py-1 rounded-lg border flex items-center gap-2">
                    <span class="text-xs font-bold text-gray-400">å•†èˆ¹åˆ©æ½¤åŠ æˆ:</span>
                    <input type="number" v-model.number="globalBonus" class="w-12 text-right font-black text-[#7B1FA2] outline-none">
                    <span class="text-xs font-bold">%</span>
                </div>
                <button @click="resetAll" class="bg-gray-400 text-white font-black px-3 py-1 rounded-lg text-xs">æ¸…ç©º</button>
            </div>
        </div>

        <div class="card-std p-4 mb-6 shadow-sm">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div v-for="(p, i) in products" :key="i" class="bg-white p-3 rounded-xl border border-gray-200 shadow-sm">
                    <div class="text-center mb-3">
                        <div class="text-lg font-black text-[#5E548E]">{{ p.label }}</div>
                        <select v-model="p.name" class="text-[10px] border rounded w-full mb-1">
                            <option value="">-- é¸æ“‡é …ç›® --</option>
                            <option v-for="opt in commonItems" :value="opt">{{ opt }}</option>
                        </select>
                        <input v-model="p.name" class="w-full text-center text-xs text-gray-400 border-b border-dashed outline-none" placeholder="è‡ªå¡«ç´°é …">
                    </div>
                    
                    <div class="space-y-1.5 text-xs font-bold">
                        <div class="flex justify-between items-center"><span>æœ¬åœ°æˆæœ¬</span><div class="w-20"><input type="number" v-model.number="p.bPrice" class="input-slim"></div></div>
                        <div class="flex justify-between items-center"><span>å¯è²·åº«å­˜</span><div class="w-20"><input type="number" v-model.number="p.stock" class="input-slim"></div></div>
                        <div class="border-t my-1"></div>
                        <div class="flex justify-between items-center"><span>ç›®çš„åœ°å”®åƒ¹</span><div class="w-20"><input type="number" v-model.number="p.sPrice" class="input-slim"></div></div>
                    </div>

                    <div class="mt-3 bg-slate-50 p-2 rounded-lg text-[10px] border border-slate-100 font-bold">
                        <div class="flex justify-between"><span>é ä¼°ç›ˆè™§:</span><span :class="colorScale(calcT0(p).rate)">+{{ calcT0(p).rate }}%</span></div>
                        <div class="flex justify-between text-sm text-[#7B1FA2] mt-1"><span>å¯¦æ‹¿ç¸½åˆ©æ½¤:</span><span>{{ format(calcT0(p).net) }}</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div v-for="(tab, tIdx) in [t1, t2]" :key="tIdx" class="card-std p-4 border-t-4" :class="tIdx===0?'border-orange-400':'border-purple-500'">
                <h3 class="font-black text-[#5E548E] mb-3 text-sm">ã€è¡¨ {{tIdx+1}}ã€‘æ–¹æ¡ˆ{{tIdx===0?'ä¸€':'äºŒ'}}ç­–ç•¥</h3>
                <div class="flex gap-2 mb-3">
                    <div class="flex-1 bg-white p-1.5 rounded border"><label class="text-[9px] text-gray-400 block">ç¸½è³‡é‡‘</label><input type="number" v-model.number="tab.fund" class="w-full text-right text-sm font-black outline-none"></div>
                    <div class="flex-1 bg-white p-1.5 rounded border"><label class="text-[9px] text-gray-400 block">è²·ç©ºæ ¸å¿ƒæˆæœ¬</label><input type="number" v-model.number="tab.minus" class="w-full text-right text-sm font-black text-red-400 outline-none"></div>
                </div>
                <table class="w-full table-fixed text-xs">
                    <thead class="text-gray-400 border-b font-black">
                        <tr>
                            <th class="w-16 text-left pb-1">åˆ†é…é …ç›®</th>
                            <th class="w-24 text-right pb-1">å”®åƒ¹</th>
                            <th class="w-16 text-right pb-1">æ•¸é‡</th>
                            <th class="text-right pb-1">å¯¦æ‹¿æ·¨åˆ©</th>
                        </tr>
                    </thead>
                    <tbody class="font-bold">
                        <tr v-for="(item, idx) in (tIdx===0 ? t1Items : t2Items)" :key="idx" class="border-b border-gray-50">
                            <td class="py-2 text-[#5E548E]">{{ item.label }}</td>
                            <td><input type="number" v-model.number="tab.inputs[idx].sPrice" class="input-slim"></td>
                            <td class="text-right text-gray-400">{{ calcSub(tab, item, idx).qty }}</td>
                            <td class="text-right text-sm text-[#7B1FA2]">{{ format(calcSub(tab, item, idx).net) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card-std p-4 bg-slate-800 text-white border-none shadow-xl">
            <div class="flex justify-between items-center">
                <div>
                    <div class="text-xs opacity-60">æœ€å„ªç­–ç•¥æ¨è–¦</div>
                    <div class="text-xl font-black text-yellow-400">{{ finalDecision }}</div>
                </div>
                <div class="text-right">
                    <div class="text-xs opacity-60">æœ€é«˜é ä¼°åˆ©æ½¤</div>
                    <div class="text-2xl font-black">{{ format(maxNet) }}</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    globalBonus: 12,
                    commonItems: ['èŠ±ç”Ÿ', 'åŸæœ¨', 'éµç¤¦', 'ç”Ÿçµ²', 'èŒ¶è‘‰', 'é¦™æ–™', 'èƒ¡æ¤’', 'ç´…å¯¶çŸ³'],
                    products: [
                        { label: 'ç‰¹ç”¢', name: '', bPrice: null, stock: null, sPrice: null },
                        { label: 'å‰¯ç”¢ 1', name: '', bPrice: null, stock: null, sPrice: null },
                        { label: 'å‰¯ç”¢ 2', name: '', bPrice: null, stock: null, sPrice: null }
                    ],
                    t1: { fund: null, minus: null, inputs: [{ sPrice: null }, { sPrice: null }] },
                    t2: { fund: null, minus: null, inputs: [{ sPrice: null }, { sPrice: null }] }
                }
            },
            computed: {
                t1Items() { return [this.products[1], this.products[2]]; },
                t2Items() { 
                    const marginRank = [...this.products].sort((a,b) => (b.sPrice-b.bPrice)/b.bPrice - (a.sPrice-a.bPrice)/a.bPrice)[0];
                    return this.products.filter(p => p.label !== marginRank.label);
                },
                maxNet() {
                    const p0 = this.calcT0(this.products[0]).net + Math.max(this.calcSub(this.t1, this.t1Items[0], 0).net, this.calcSub(this.t1, this.t1Items[1], 1).net);
                    const pN = Math.max(...this.products.map(p => this.calcT0(p).net));
                    return Math.max(p0, pN);
                },
                finalDecision() {
                    if (!this.products[0].bPrice) return "ç­‰å¾…æ•¸æ“šè¼¸å…¥...";
                    return "ä¾æ“šåˆ©æ½¤æœ€å¤§åŒ–åˆ†é…è³‡é‡‘";
                }
            },
            methods: {
                calcT0(p) {
                    if(!p.bPrice || !p.sPrice) return { rate: 0, net: 0 };
                    const diff = p.sPrice - p.bPrice;
                    const bonus = 1 + (this.globalBonus / 100);
                    return {
                        rate: Math.round((diff / p.bPrice) * 100),
                        net: diff * Math.floor(p.stock || 0) * bonus
                    };
                },
                calcSub(tab, pBase, idx) {
                    const remain = (tab.fund || 0) - (tab.minus || 0);
                    const sPrice = tab.inputs[idx].sPrice;
                    if (!pBase.bPrice || !sPrice || remain <= 0) return { qty: 0, net: 0 };
                    const qty = Math.floor(remain / pBase.bPrice);
                    const bonus = 1 + (this.globalBonus / 100);
                    return { qty, net: (sPrice - pBase.bPrice) * qty * bonus };
                },
                colorScale(v) { return v > 0 ? 'text-gain' : 'text-loss'; },
                format(v) { return Math.floor(v || 0).toLocaleString(); },
                resetAll() { if(confirm("ç¢ºå®šæ¸…ç©ºï¼Ÿ")) Object.assign(this.$data, this.$options.data()); }
            }
        }).mount('#app');
    </script>
</body>
</html>
