<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å¤§èˆªç·šï¼šç­–ç•¥æ±ºç­–ç³»çµ± v13</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root { --hpink: #FF9D6F; --mbg: #FBFBF9; --spurple: #5E548E; --gain-red: #E53935; --fgreen: #00897B; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #EAE8E4; color: #6D6875; }
        [v-cloak] { display: none; }
        .card-std { background: var(--mbg); border: 1px solid #D7D3CC; border-radius: 1rem; overflow: hidden; }
        .input-inline {
            background: #FFFFFF; border: 1px solid #D7D3CC; border-radius: 4px;
            padding: 0 4px; text-align: right; height: 28px;
            font-weight: 900; color: #5E548E; outline: none; font-size: 13px;
        }
        .text-gain { color: var(--gain-red); }
        .text-loss { color: var(--fgreen); }
        .row-label { font-size: 12px; color: #94A3B8; font-weight: bold; }
    </style>
</head>
<body class="p-2 md:p-4">
    <div id="app" v-cloak class="max-w-[1200px] mx-auto pb-12">
        
        <div class="flex flex-wrap justify-between items-center mb-4 px-2 gap-4">
            <div class="flex items-center gap-4">
                <h1 class="text-xl font-black text-[#5E548E]">ğŸš¢ æ™ºæ…§æ±ºç­–ç³»çµ± v13</h1>
                <div class="bg-slate-700 text-white px-4 py-1 rounded-full flex items-center gap-2 shadow-lg">
                    <span class="text-xs font-bold">ç¾æœ‰ç¸½è³‡é‡‘:</span>
                    <input type="number" v-model.number="totalFund" class="bg-transparent border-b border-white w-24 text-right font-black outline-none text-yellow-400">
                </div>
            </div>
            <div class="flex gap-2">
                <button @click="saveData" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-xs font-bold shadow">ğŸ’¾ å­˜æª”</button>
                <button @click="resetAll" class="bg-red-400 text-white px-3 py-1 rounded-lg text-xs font-bold shadow">ğŸ—‘ï¸ å…¨éƒ¨æ¸…é™¤</button>
            </div>
        </div>

        <div class="card-std p-4 mb-6 shadow-sm border-t-4 border-slate-500">
            <div class="flex gap-3 mb-4 border-b pb-3">
                <div class="bg-orange-500 text-white px-3 py-1 rounded text-xs font-black shadow-sm">ğŸ† æ¯›åˆ©ç‹ï¼š{{ rankMargin.label || '---' }}</div>
                <div class="bg-purple-600 text-white px-3 py-1 rounded text-xs font-black shadow-sm">ğŸ’° æ·¨åˆ©ç‹ï¼š{{ rankNet.label || '---' }}</div>
                <div class="ml-auto text-[10px] text-gray-400 font-bold self-center">å•†èˆ¹åŠ æˆ: {{ globalBonus }}%</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div v-for="(p, i) in products" :key="i" class="bg-white p-4 rounded-xl border border-gray-200 relative shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-lg font-black text-[#5E548E]">{{ p.label }}</span>
                        <input v-model="p.name" class="w-24 text-right text-xs text-gray-400 border-b border-dashed outline-none" placeholder="è¼¸å…¥å“å">
                    </div>

                    <div class="space-y-3">
                        <div class="grid grid-cols-12 items-center gap-2">
                            <span class="col-span-2 row-label">æˆæœ¬</span>
                            <input type="number" v-model.number="p.bPrice" class="col-span-5 input-inline">
                            <span class="col-span-2 row-label text-center">æ¼²å¹…</span>
                            <input type="number" v-model.number="p.bTrend" :class="p.bTrend > 0 ? 'text-gain' : 'text-loss'" class="col-span-3 input-inline">
                        </div>

                        <div class="grid grid-cols-12 items-center gap-2">
                            <span class="col-span-3 row-label">å¯è²·åº«å­˜</span>
                            <input type="number" v-model.number="p.stock" class="col-span-9 input-inline">
                        </div>

                        <div class="grid grid-cols-12 items-center gap-2">
                            <span class="col-span-2 row-label">å”®åƒ¹</span>
                            <input type="number" v-model.number="p.sPrice" class="col-span-5 input-inline">
                            <span class="col-span-2 row-label text-center">æ¼²å¹…</span>
                            <input type="number" v-model.number="p.sTrend" :class="p.sTrend > 0 ? 'text-gain' : 'text-loss'" class="col-span-3 input-inline">
                        </div>

                        <div class="grid grid-cols-12 items-center gap-2 pt-1 border-t border-gray-50">
                            <span class="col-span-2 row-label">ç›ˆè™§</span>
                            <div class="col-span-5 text-right font-black text-sm" :class="colorScale(calcT0(p).rate)">{{ calcT0(p).rate }}%</div>
                            <span class="col-span-2 row-label text-center">é åˆ¤</span>
                            <div class="col-span-3 text-right font-black text-sm" :class="colorScale(p.sTrend - p.bTrend)">{{ p.sTrend - p.bTrend }}%</div>
                        </div>
                    </div>

                    <div class="mt-4 pt-3 border-t-2 border-dashed flex justify-between items-center">
                        <div>
                            <div class="text-[10px] text-gray-400 font-bold uppercase">é ä¼°æ¯›åˆ© (å–®)</div>
                            <div class="text-sm font-black text-slate-600">{{ format(calcT0(p).margin) }}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-purple-400 font-bold uppercase">æœ€çµ‚æ·¨åˆ© (å…¨)</div>
                            <div class="text-xl font-black text-[#7B1FA2]">{{ format(calcT0(p).net) }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <div class="card-std p-4 border-t-4 border-orange-400">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-black text-sm text-[#5E548E]">æ–¹æ¡ˆä¸€ï¼šç‰¹ç”¢å„ªå…ˆç­–ç•¥</h3>
                    <div class="text-[10px] font-bold bg-white px-2 py-1 rounded border">è€—è³‡ï¼š<input type="number" v-model.number="t1Minus" class="w-12 text-right outline-none"></div>
                </div>
                <table class="w-full text-[11px] font-bold">
                    <thead class="text-gray-400 border-b">
                        <tr>
                            <th class="text-left py-1">å“å</th>
                            <th class="text-right">ç›®çš„åœ°å”®åƒ¹</th>
                            <th class="text-right">æ•¸é‡</th>
                            <th class="text-right">æ·¨åˆ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, idx) in t1Items" :key="idx" class="border-b border-gray-50">
                            <td class="py-2">{{ item.label }}</td>
                            <td><input type="number" v-model.number="t1Inputs[idx].sPrice" class="input-inline w-20 float-right"></td>
                            <td class="text-right text-gray-400">{{ calcT1Sub(item, idx).qty }}</td>
                            <td class="text-right text-[#7B1FA2]">{{ format(calcT1Sub(item, idx).net) }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="mt-4 text-right font-black text-orange-600">ç¸½æ”¶ç›Šï¼š{{ format(t1Total) }}</div>
            </div>

            <div class="card-std p-4 border-t-4 border-purple-500">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-black text-sm text-[#5E548E]">æ–¹æ¡ˆäºŒï¼šæ¯›åˆ©ç‹å„ªå…ˆç­–ç•¥</h3>
                    <div class="text-[10px] font-bold bg-white px-2 py-1 rounded border">è€—è³‡ï¼š<input type="number" v-model.number="t2Minus" class="w-12 text-right outline-none"></div>
                </div>
                <table class="w-full text-[11px] font-bold">
                    <thead class="text-gray-400 border-b">
                        <tr>
                            <th class="text-left py-1">å“å</th>
                            <th class="text-right">ç›®çš„åœ°å”®åƒ¹</th>
                            <th class="text-right">æ•¸é‡</th>
                            <th class="text-right">æ·¨åˆ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, idx) in t2Items" :key="idx" class="border-b border-gray-50">
                            <td class="py-2">{{ item.label }}</td>
                            <td><input type="number" v-model.number="t2Inputs[idx].sPrice" class="input-inline w-20 float-right"></td>
                            <td class="text-right text-gray-400">{{ calcT2Sub(item, idx).qty }}</td>
                            <td class="text-right text-[#7B1FA2]">{{ format(calcT2Sub(item, idx).net) }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="mt-4 text-right font-black text-purple-600">ç¸½æ”¶ç›Šï¼š{{ format(t2Total) }}</div>
            </div>
        </div>

        <div class="card-std p-5 bg-slate-800 text-white shadow-xl">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex-1">
                    <div class="text-yellow-400 font-black text-lg">ğŸ’¡ æ±ºç­–åˆ†æ</div>
                    <p class="text-xs text-slate-300">{{ decisionReason }}</p>
                </div>
                <div class="text-right border-l border-slate-700 pl-6">
                    <div class="text-[10px] text-slate-400 font-bold">é ä¼°æœ€å¤§æ·¨æ”¶ç›Š</div>
                    <div class="text-3xl font-black text-white">{{ format(maxProfit) }}</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    totalFund: 10000,
                    globalBonus: 12,
                    t1Minus: 0,
                    t2Minus: 0,
                    products: [
                        { label: 'ç‰¹ç”¢', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 1', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 2', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 }
                    ],
                    t1Inputs: [{ sPrice: null }, { sPrice: null }],
                    t2Inputs: [{ sPrice: null }, { sPrice: null }]
                }
            },
            computed: {
                rankMargin() {
                    let best = { label: '---', rate: -Infinity };
                    this.products.forEach(p => {
                        const rate = p.bPrice ? (p.sPrice - p.bPrice) / p.bPrice : -Infinity;
                        if (rate > best.rate) { best = { label: p.label, rate: rate }; }
                    });
                    return best;
                },
                rankNet() {
                    let best = { label: '---', net: -Infinity };
                    this.products.forEach(p => {
                        const net = this.calcT0(p).net;
                        if (net > best.net) { best = { label: p.label, net: net }; }
                    });
                    return best;
                },
                t1Items() { return [this.products[1], this.products[2]]; },
                t2Items() { 
                    const m = this.rankMargin.label;
                    return this.products.filter(p => p.label !== m);
                },
                t1Total() {
                    const p0 = this.products[0];
                    const p0Net = this.calcT0(p0).net;
                    const subNets = this.t1Items.map((item, idx) => this.calcT1Sub(item, idx).net);
                    return p0Net + Math.max(0, ...subNets);
                },
                t2Total() {
                    const mLabel = this.rankMargin.label;
                    const mObj = this.products.find(p => p.label === mLabel) || this.products[0];
                    const mNet = this.calcT0(mObj).net;
                    const subNets = this.t2Items.map((item, idx) => this.calcT2Sub(item, idx).net);
                    return mNet + Math.max(0, ...subNets);
                },
                maxProfit() { return Math.max(this.t1Total, this.t2Total, this.calcT0(this.rankNet).net || 0); },
                decisionReason() {
                    if (!this.products[0].bPrice) return "è«‹è¼¸å…¥ç‰¹ç”¢å ±åƒ¹ä»¥é€²è¡Œåˆ†æã€‚";
                    if (this.t1Total >= this.t2Total && this.t1Total > this.calcT0(this.rankNet).net) {
                        return "ã€æ–¹æ¡ˆä¸€ã€‘ç‚ºå„ªï¼šå„ªå…ˆè²·ç©ºç‰¹ç”¢ï¼Œåˆ©ç”¨é¤˜é¡æŠ•è³‡å‰¯ç”¢ç‰©ï¼Œèƒ½ç²å¾—æœ€é«˜ç¸½åˆ©æ½¤ã€‚";
                    } else if (this.t2Total > this.t1Total) {
                        return `ã€æ–¹æ¡ˆäºŒã€‘ç‚ºå„ªï¼šè²·ç©ºã€Œ${this.rankMargin.label}ã€æ•ˆç‡æ›´é«˜ï¼Œå‰©é¤˜è³‡é‡‘è½‰æŠ•å¾Œåˆ©æ½¤å„ªæ–¼ç‰¹ç”¢ã€‚`;
                    } else {
                        return "ã€å–®è²·ç­–ç•¥ã€‘ç‚ºå„ªï¼šç›®å‰è³‡é‡‘åˆ†é…ä¸‹ï¼Œç›´æ¥è²·ç©ºæ·¨åˆ©ç‹æ˜¯æœ€ç©©å®šçš„é¸æ“‡ã€‚";
                    }
                }
            },
            methods: {
                calcMaxQty(p) {
                    if (!p || !p.bPrice || p.bPrice <= 0) return 0;
                    return Math.min(Math.floor(p.stock || 0), Math.floor(this.totalFund / p.bPrice));
                },
                calcT0(p) {
                    if (!p.bPrice || !p.sPrice) return { margin: 0, net: 0, rate: 0 };
                    const diff = p.sPrice - p.bPrice;
                    const bonus = 1 + (this.globalBonus / 100);
                    const qty = this.calcMaxQty(p);
                    return {
                        margin: diff * bonus,
                        net: diff * qty * bonus,
                        rate: Math.round((diff / p.bPrice) * 100)
                    };
                },
                calcT1Sub(p, idx) {
                    const p0 = this.products[0];
                    const remain = this.totalFund - (this.calcMaxQty(p0) * p0.bPrice) - this.t1Minus;
                    if (remain <= 0 || !p.bPrice || !this.t1Inputs[idx].sPrice) return { qty: 0, net: 0 };
                    const qty = Math.floor(remain / p.bPrice);
                    const net = (this.t1Inputs[idx].sPrice - p.bPrice) * qty * (1 + this.globalBonus/100);
                    return { qty, net };
                },
                calcT2Sub(p, idx) {
                    const mLabel = this.rankMargin.label;
                    const mObj = this.products.find(p => p.label === mLabel) || this.products[0];
                    const remain = this.totalFund - (this.calcMaxQty(mObj) * mObj.bPrice) - this.t2Minus;
                    if (remain <= 0 || !p.bPrice || !this.t2Inputs[idx].sPrice) return { qty: 0, net: 0 };
                    const qty = Math.floor(remain / p.bPrice);
                    const net = (this.t2Inputs[idx].sPrice - p.bPrice) * qty * (1 + this.globalBonus/100);
                    return { qty, net };
                },
                format(v) { return Math.floor(v || 0).toLocaleString(); },
                colorScale(v) { return v > 0 ? 'text-gain' : (v < 0 ? 'text-loss' : 'text-gray-400'); },
                saveData() { localStorage.setItem('sail_v13', JSON.stringify(this.$data)); alert('å­˜æª”æˆåŠŸ'); },
                resetAll() { if(confirm("ç¢ºå®šé‡ç½®ï¼Ÿ")) { localStorage.removeItem('sail_v13'); location.reload(); } }
            },
            mounted() {
                const s = localStorage.getItem('sail_v13');
                if(s) Object.assign(this.$data, JSON.parse(s));
            }
        }).mount('#app');
    </script>
</body>
</html>
