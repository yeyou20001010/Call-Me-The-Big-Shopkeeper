<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å¤§èˆªç·šï¼šæ™ºæ…§è¯å‹•ç³»çµ± v12</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root { --hpink: #FF9D6F; --mbg: #FBFBF9; --spurple: #5E548E; --gain-red: #E53935; --fgreen: #00897B; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #EAE8E4; color: #6D6875; }
        [v-cloak] { display: none; }
        .card-std { background: var(--mbg); border: 1px solid #D7D3CC; border-radius: 1rem; overflow: hidden; }
        .input-inline {
            background: #FFFFFF; border: 1px solid #D7D3CC; border-radius: 4px;
            padding: 0 4px; text-align: right; height: 26px;
            font-weight: 900; color: #5E548E; outline: none; font-size: 13px;
        }
        .text-gain { color: var(--gain-red); }
        .text-loss { color: var(--fgreen); }
    </style>
</head>
<body class="p-2 md:p-4">
    <div id="app" v-cloak class="max-w-[1200px] mx-auto pb-12">
        
        <div class="flex flex-wrap justify-between items-center mb-4 px-2 gap-4">
            <div class="flex items-center gap-4">
                <h1 class="text-xl font-black text-[#5E548E]">ğŸš¢ æ™ºæ…§è¯å‹•æ±ºç­–ç³»çµ±</h1>
                <div class="bg-slate-700 text-white px-4 py-1 rounded-full flex items-center gap-2 shadow-lg">
                    <span class="text-xs font-bold">ç¾æœ‰ç¸½è³‡é‡‘:</span>
                    <input type="number" v-model.number="totalFund" class="bg-transparent border-b border-white w-24 text-right font-black outline-none text-yellow-400">
                </div>
            </div>
            <div class="flex gap-2 no-print">
                <button @click="saveData" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-xs font-bold shadow">ğŸ’¾ å­˜æª”</button>
                <button @click="resetAll" class="bg-red-400 text-white px-3 py-1 rounded-lg text-xs font-bold shadow">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
        </div>

        <div class="card-std p-4 mb-6 shadow-sm border-t-4 border-slate-500">
            <div class="flex justify-between items-center mb-3">
                <h2 class="font-black text-sm">ã€ç¬¬ä¸€æ­¥ã€‘è¼¸å…¥ç•¶å‰å¸‚å ´è¡Œæƒ…</h2>
                <div class="flex gap-2">
                    <span class="text-[10px] font-bold bg-orange-100 text-orange-600 px-2 py-0.5 rounded">æ¯›åˆ©ç‹: {{ rankMargin.label }}</span>
                    <span class="text-[10px] font-bold bg-purple-100 text-purple-600 px-2 py-0.5 rounded">æ·¨åˆ©ç‹: {{ rankNet.label }}</span>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div v-for="(p, i) in products" :key="i" class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-center mb-2 font-black border-b pb-1">
                        <span class="text-[#5E548E]">{{ p.label }}</span>
                        <input v-model="p.name" class="w-20 text-right text-xs text-gray-400 outline-none" placeholder="å“å">
                    </div>
                    <div class="space-y-2 text-xs font-bold">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-400">æœ¬åœ°æˆæœ¬</span>
                            <div class="flex items-center gap-1">
                                <input type="number" v-model.number="p.bPrice" @input="validatePositive(p, 'bPrice')" class="input-inline w-20">
                                <input type="number" v-model.number="p.bTrend" class="input-inline w-12 text-gray-400">
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-400">ç›®çš„å”®åƒ¹</span>
                            <div class="flex items-center gap-1">
                                <input type="number" v-model.number="p.sPrice" @input="validatePositive(p, 'sPrice')" class="input-inline w-20">
                                <input type="number" v-model.number="p.sTrend" class="input-inline w-12 text-gray-400">
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-400">åº«å­˜é‡</span>
                            <input type="number" v-model.number="p.stock" @input="validateInteger(p, 'stock')" class="input-inline w-20">
                        </div>
                    </div>
                    <div class="mt-3 pt-2 border-t border-dashed flex justify-between text-[10px] font-bold">
                        <div class="text-gray-400">å¯è²·ä¸Šé™: <span class="text-slate-600">{{ calcMaxQty(p) }}</span></div>
                        <div class="text-[#7B1FA2]">é ä¼°æ·¨åˆ©: {{ format(calcT0(p).net) }}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <div class="card-std p-4 border-t-4 border-orange-400 shadow">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-black text-sm text-[#5E548E]">ã€æ–¹æ¡ˆä¸€ã€‘ç‰¹ç”¢å„ªå…ˆ</h3>
                    <div class="bg-white px-2 py-0.5 rounded border text-[10px] font-bold">è€—è³‡: <input type="number" v-model.number="t1Minus" class="w-8 text-right outline-none"></div>
                </div>
                <p class="text-[9px] text-gray-400 mb-3">è‡ªå‹•è²·æ»¿ã€ç‰¹ç”¢ã€‘æ•¸é‡: {{ calcMaxQty(products[0]) }}ï¼Œå‰©é¤˜è³‡é‡‘é…çµ¦å‰¯ç”¢ã€‚</p>
                <table class="w-full text-[11px] font-bold">
                    <thead class="text-gray-400 border-b">
                        <tr>
                            <th class="text-left py-1">å“å</th>
                            <th class="text-right">é è¨ˆå”®åƒ¹</th>
                            <th class="text-right">æ•¸é‡</th>
                            <th class="text-right">é ä¼°æ·¨åˆ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, idx) in t1Items" class="border-b border-gray-50">
                            <td class="py-2">{{ item.label }}</td>
                            <td><input type="number" v-model.number="t1Inputs[idx].sPrice" class="input-inline w-20 float-right"></td>
                            <td class="text-right text-gray-400">{{ calcT1Sub(item, idx).qty }}</td>
                            <td class="text-right text-[#7B1FA2]">{{ format(calcT1Sub(item, idx).net) }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="mt-4 text-right border-t pt-2"><span class="text-xs text-gray-400">æ–¹æ¡ˆç¸½æ”¶ï¼š</span><span class="text-lg font-black text-orange-600">{{ format(t1Total) }}</span></div>
            </div>

            <div class="card-std p-4 border-t-4 border-purple-500 shadow">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-black text-sm text-[#5E548E]">ã€æ–¹æ¡ˆäºŒã€‘æ¯›åˆ©ç‹å„ªå…ˆ</h3>
                    <div class="bg-white px-2 py-0.5 rounded border text-[10px] font-bold">è€—è³‡: <input type="number" v-model.number="t2Minus" class="w-8 text-right outline-none"></div>
                </div>
                <p class="text-[9px] text-gray-400 mb-3">è‡ªå‹•è²·æ»¿ã€{{ rankMargin.label }}ã€‘æ•¸é‡: {{ calcMaxQty(rankMargin) }}ï¼Œè¿½æ±‚æœ€é«˜æŠ•è³‡æ•ˆç‡ã€‚</p>
                <table class="w-full text-[11px] font-bold">
                    <thead class="text-gray-400 border-b">
                        <tr>
                            <th class="text-left py-1">å“å</th>
                            <th class="text-right">é è¨ˆå”®åƒ¹</th>
                            <th class="text-right">æ•¸é‡</th>
                            <th class="text-right">é ä¼°æ·¨åˆ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, idx) in t2Items" class="border-b border-gray-50">
                            <td class="py-2">{{ item.label }}</td>
                            <td><input type="number" v-model.number="t2Inputs[idx].sPrice" class="input-inline w-20 float-right"></td>
                            <td class="text-right text-gray-400">{{ calcT2Sub(item, idx).qty }}</td>
                            <td class="text-right text-[#7B1FA2]">{{ format(calcT2Sub(item, idx).net) }}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="mt-4 text-right border-t pt-2"><span class="text-xs text-gray-400">æ–¹æ¡ˆç¸½æ”¶ï¼š</span><span class="text-lg font-black text-purple-600">{{ format(t2Total) }}</span></div>
            </div>
        </div>

        <div class="card-std p-5 bg-slate-800 text-white shadow-2xl relative">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex-1">
                    <div class="text-yellow-400 font-black text-lg mb-1">ğŸ’¡ æ±ºç­–å»ºè­°ï¼š{{ finalDecision.title }}</div>
                    <p class="text-xs text-slate-300 leading-relaxed">{{ finalDecision.reason }}</p>
                </div>
                <div class="text-right border-l border-slate-700 pl-6">
                    <div class="text-[10px] text-slate-400 font-bold mb-1">æœ¬æ¬¡èˆªè¡Œæœ€å¤§æ½›åŠ›</div>
                    <div class="text-3xl font-black text-white">{{ format(maxProfit) }}</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    totalFund: 10000, globalBonus: 12,
                    t1Minus: 0, t2Minus: 0,
                    products: [
                        { label: 'ç‰¹ç”¢', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 1', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 },
                        { label: 'å‰¯ç”¢ 2', name: '', bPrice: null, bTrend: 0, stock: null, sPrice: null, sTrend: 0 }
                    ],
                    t1Inputs: [{ sPrice: null }, { sPrice: null }],
                    t2Inputs: [{ sPrice: null }, { sPrice: null }]
                }
            },
            computed: {
                rankMargin() {
                    return [...this.products].sort((a,b) => {
                        const ra = a.bPrice ? (a.sPrice - a.bPrice)/a.bPrice : -1;
                        const rb = b.bPrice ? (b.sPrice - b.bPrice)/b.bPrice : -1;
                        return rb - ra;
                    })[0];
                },
                rankNet() { return [...this.products].sort((a,b) => this.calcT0(b).net - this.calcT0(a).net)[0]; },
                t1Items() { return [this.products[1], this.products[2]]; },
                t2Items() { return this.products.filter(p => p.label !== this.rankMargin.label); },
                t1Total() {
                    const bonus = 1 + (this.globalBonus / 100);
                    const p0 = this.products[0];
                    const p0Net = (p0.sPrice - p0.bPrice) * this.calcMaxQty(p0) * bonus;
                    const subNets = this.t1Items.map((item, idx) => this.calcT1Sub(item, idx).net);
                    return (p0Net || 0) + Math.max(...subNets);
                },
                t2Total() {
                    const bonus = 1 + (this.globalBonus / 100);
                    const m0 = this.rankMargin;
                    const m0Net = (m0.sPrice - m0.bPrice) * this.calcMaxQty(m0) * bonus;
                    const subNets = this.t2Items.map((item, idx) => this.calcT2Sub(item, idx).net);
                    return (m0Net || 0) + Math.max(...subNets);
                },
                maxProfit() { return Math.max(this.t1Total, this.t2Total, ...this.products.map(p => this.calcT0(p).net)); },
                finalDecision() {
                    if (!this.products[0].bPrice) return { title: "ç­‰å¾…æ•¸æ“š", reason: "è«‹è¼¸å…¥åŸºç¤å ±åƒ¹ã€‚" };
                    const t0Max = this.calcT0(this.rankNet).net;
                    if (this.t1Total >= this.t2Total && this.t1Total > t0Max) {
                        return { title: "åŸ·è¡Œã€æ–¹æ¡ˆä¸€ï¼šç‰¹ç”¢å„ªå…ˆã€‘", reason: "ç‰¹ç”¢å–®åƒ¹é«˜ä¸”ç©©å®šã€‚è²·æ»¿ç‰¹ç”¢å¾Œï¼Œåˆ©ç”¨å‰©é¤˜è³‡é‡‘è³¼è²·å‰¯ç”¢ï¼Œç¸½åˆ©æ½¤æœ€é«˜ã€‚é©åˆç‰¹ç”¢ç›ˆè™§%ä¸ä½æ–¼å‰¯ç”¢å¤ªå¤šçš„æƒ…æ³ã€‚" };
                    } else if (this.t2Total > t0Max) {
                        return { title: "åŸ·è¡Œã€æ–¹æ¡ˆäºŒï¼šæ•ˆç‡å„ªå…ˆã€‘", reason: `ç”¢å“ ${this.rankMargin.label} çš„ç›ˆè™§æ¯”æœ€é«˜ã€‚è²·æ»¿å®ƒèƒ½æœ€å¿«æ¶ˆåŒ–è³‡é‡‘ä¸¦é¨°å‡ºç©ºé–“ï¼Œå‰©é¤˜è³‡é‡‘é…çµ¦å…¶ä»–ï¼Œç¸½é«”åˆ©æ½¤å¤§æ–¼å–®è²·ç‰¹ç”¢ã€‚` };
                    } else {
                        return { title: "åŸ·è¡Œã€å–®è²·ç­–ç•¥ã€‘", reason: "è³‡é‡‘å‰©é¤˜ä¸è¶³ä»¥è³¼è²·å…¶ä»–ä»»ä½•å“é …ï¼Œæˆ–å¤šè²·ç”¢ç”Ÿçš„é‚Šéš›åˆ©æ½¤éä½ã€‚ç›´æ¥æƒå…‰æ·¨åˆ©ç‹å³å¯ã€‚" };
                    }
                }
            },
            methods: {
                calcMaxQty(p) {
                    if (!p.bPrice || !this.totalFund) return 0;
                    return Math.min(Math.floor(p.stock || 0), Math.floor(this.totalFund / p.bPrice));
                },
                calcT0(p) {
                    if(!p.bPrice || !p.sPrice) return { net: 0 };
                    return { net: (p.sPrice - p.bPrice) * this.calcMaxQty(p) * (1 + this.globalBonus/100) };
                },
                calcT1Sub(p, idx) {
                    const p0 = this.products[0];
                    const remain = this.totalFund - (this.calcMaxQty(p0) * p0.bPrice) - this.t1Minus;
                    if (remain <= 0 || !p.bPrice || !this.t1Inputs[idx].sPrice) return { qty: 0, net: 0 };
                    const qty = Math.floor(remain / p.bPrice);
                    const net = (this.t1Inputs[idx].sPrice - p.bPrice) * qty * (1 + this.globalBonus/100);
                    return { qty, net };
                },
                calcT2Sub(p, idx) {
                    const m0 = this.rankMargin;
å‘                  const remain = this.totalFund - (this.calcMaxQty(m0) * m0.bPrice) - this.t2Minus;
                    if (remain <= 0 || !p.bPrice || !this.t2Inputs[idx].sPrice) return { qty: 0, net: 0 };
                    const qty = Math.floor(remain / p.bPrice);
                    const net = (this.t2Inputs[idx].sPrice - p.bPrice) * qty * (1 + this.globalBonus/100);
                    return { qty, net };
                },
                validatePositive(p, field) { if(p[field] < 0) p[field] = 0; },
                validateInteger(p, field) { p[field] = Math.floor(Math.abs(p[field] || 0)); },
                format(v) { return Math.floor(v || 0).toLocaleString(); },
                saveData() { localStorage.setItem('sail_v12', JSON.stringify(this.$data)); alert('å­˜æª”æˆåŠŸ'); },
                resetAll() { if(confirm("ç¢ºå®šé‡ç½®ï¼Ÿ")) { localStorage.removeItem('sail_v12'); location.reload(); } }
            },
            mounted() {
                const s = localStorage.getItem('sail_v12');
                if(s) Object.assign(this.$data, JSON.parse(s));
            }
        }).mount('#app');
    </script>
</body>
</html>
