<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>æ´»å‹•å·¥å…·ç®± - ä¸»é¸å–®</title>
</head>
<body class="bg-slate-50 p-4 md:p-12 transition-colors duration-300" id="mainBody">
    <div class="max-w-4xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4">
            <div>
                <h1 id="userName" class="text-3xl font-black text-slate-800">è¼‰å…¥ä¸­...</h1>
                <p id="userRole" class="text-blue-600 font-bold text-sm uppercase tracking-widest"></p>
            </div>
            <button onclick="logout()" class="bg-white px-6 py-2 rounded-xl shadow-sm text-slate-500 font-bold hover:bg-red-50 hover:text-red-500 transition">ç™»å‡º</button>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 md:gap-6">
            <button onclick="location.href='stamina.html'" class="bg-white p-6 md:p-8 rounded-3xl shadow-sm hover:shadow-xl transition text-left border-b-8 border-blue-500">
                <span class="text-3xl">âš¡</span><h3 class="font-bold mt-2">é«”åŠ›ç´€éŒ„</h3>
            </button>
            <button onclick="location.href='flipping.html'" class="bg-white p-6 md:p-8 rounded-3xl shadow-sm hover:shadow-xl transition text-left border-b-8 border-red-500">
                <span class="text-3xl">ğŸƒ</span><h3 class="font-bold mt-2">ç¿»ç‰Œå·¥å…·</h3>
            </button>
            <button onclick="location.href='voyage.html'" class="bg-white p-6 md:p-8 rounded-3xl shadow-sm hover:shadow-xl transition text-left border-b-8 border-amber-500">
                <span class="text-3xl">ğŸš¢</span><h3 class="font-bold mt-2">å‰å¤§èˆªç·š</h3>
            </button>
        </div>

        <div id="adminPanel" class="hidden mt-10 p-6 md:p-8 bg-slate-900 rounded-[2rem] text-white shadow-2xl">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xs font-bold text-slate-400 uppercase tracking-[0.2em]">ç®¡ç†å“¡æ§åˆ¶å°</h2>
                <span class="bg-indigo-500 text-[10px] px-2 py-1 rounded">ADMIN ONLY</span>
            </div>
            <div class="flex flex-wrap gap-3">
                <button onclick="openConfigModal()" class="bg-indigo-600 px-6 py-3 rounded-xl text-sm font-bold hover:bg-indigo-500 transition">ä¿®æ”¹ç³»çµ±é…ç½® (å…¬å‘Š/ä¸»é¡Œ)</button>
                <button id="superAdminBtn" class="hidden bg-amber-600 px-6 py-3 rounded-xl text-sm font-bold hover:bg-amber-500 transition">ä½¿ç”¨è€…æ¬Šé™ç®¡ç†</button>
            </div>
        </div>
    </div>

    <div id="configModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-4 z-50">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl">
            <h3 class="text-xl font-black mb-6">ç³»çµ±é…ç½®ä¿®æ”¹</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-2">å…¨ç«™å…¬å‘Šå…§å®¹</label>
                    <textarea id="announceInput" class="w-full border-2 border-slate-100 rounded-xl p-3 text-sm focus:border-indigo-500 outline-none" rows="3"></textarea>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-2">åˆ‡æ›ä½ˆæ™¯ä¸»é¡Œ</label>
                    <select id="themeInput" class="w-full border-2 border-slate-100 rounded-xl p-3 text-sm">
                        <option value="default">é è¨­è—ç™½</option>
                        <option value="christmas">è–èª•ç´… (Christmas)</option>
                        <option value="dark">æ·±è‰²æ¨¡å¼ (Dark)</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button onclick="closeConfigModal()" class="flex-1 py-3 text-slate-400 font-bold text-sm">å–æ¶ˆ</button>
                <button onclick="saveConfig()" class="flex-1 bg-indigo-600 text-white py-3 rounded-2xl font-bold text-sm shadow-lg shadow-indigo-200">å„²å­˜ä¸¦å¥—ç”¨</button>
            </div>
        </div>
    </div>

    <script>
        let userData = null;

        window.onload = function() {
            const data = JSON.parse(sessionStorage.getItem('gameData'));
            if(!data) return location.href = "index.html";
            userData = data;

            // é¡¯ç¤ºå€‹äººè³‡è¨Š
            document.getElementById('userName').innerText = "æ‚¨å¥½, " + data.user.name;
            document.getElementById('userRole').innerText = "æ¬Šé™: " + data.user.role;
            
            // æ¬Šé™åˆ†ç´šé¡¯ç¤º
            if(data.user.level >= 10) {
                document.getElementById('adminPanel').classList.remove('hidden');
                if(data.user.level === 99) document.getElementById('superAdminBtn').classList.remove('hidden');
            }

            // å¥—ç”¨å…¬å‘Šèˆ‡ä¸»é¡Œ
            if(data.config.CurrentTheme) applyTheme(data.config.CurrentTheme);
        };

        function applyTheme(theme) {
            const body = document.getElementById('mainBody');
            if(theme === 'christmas') body.classList.add('bg-red-50');
            else if(theme === 'dark') body.classList.add('bg-slate-900', 'text-white');
        }

        function openConfigModal() {
            document.getElementById('announceInput').value = userData.config.AnnounceText || "";
            document.getElementById('themeInput').value = userData.config.CurrentTheme || "default";
            document.getElementById('configModal').classList.replace('hidden', 'flex');
        }

        function closeConfigModal() {
            document.getElementById('configModal').classList.replace('flex', 'hidden');
        }

        function saveConfig() {
            const newAnnounce = document.getElementById('announceInput').value;
            const newTheme = document.getElementById('themeInput').value;
            alert("æ­£åœ¨ä¿å­˜è‡³è©¦ç®—è¡¨...\n(æ­¤è™•éœ€å¯¦ä½œ GAS å›å‚³ APIï¼Œç›®å‰åƒ…å…ˆæ›´æ–°æœ¬åœ°é¡¯ç¤º)");
            
            // æ›´æ–°æœ¬åœ°å¿«å–
            userData.config.AnnounceText = newAnnounce;
            userData.config.CurrentTheme = newTheme;
            sessionStorage.setItem('gameData', JSON.stringify(userData));
            
            location.reload(); // é‡æ–°æ•´ç†çœ‹æ•ˆæœ
        }

        function logout() { sessionStorage.clear(); location.href = "index.html"; }
    </script>
</body>
</html>
