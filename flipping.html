<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¿»ç‰Œè·¯å¾‘ç´€éŒ„å™¨ - å®Œæ•´ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å¼•å…¥ä½ åŸæœ¬çš„ CSS æ ¸å¿ƒæ¨£å¼ */
        .card-slot { border: 2px dashed #ccc; border-radius: 8px; aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; cursor: pointer; background: #fff; transition: all 0.2s; position: relative; }
        .card-slot:hover { border-color: #3b82f6; background: #f0f7ff; }
        .card-slot img { max-width: 85%; max-height: 85%; pointer-events: none; }
        .selected-btn { border: 3px solid #3b82f6 !important; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .grid-label { font-size: 12px; font-weight: bold; color: #94a3b8; margin-bottom: 8px; letter-spacing: 0.1em; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen pb-20">

    <div id="auth-guard" class="fixed inset-0 bg-white z-50 flex items-center justify-center font-bold text-slate-400">ç³»çµ±é©—è­‰ä¸­...</div>

    <div class="max-w-[1400px] mx-auto p-4">
        <div class="flex flex-wrap justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-sm gap-4">
            <div class="flex items-center gap-3">
                <span class="text-2xl">ğŸƒ</span>
                <h1 class="text-xl font-black text-slate-800">ç¿»ç‰Œè·¯å¾‘ç´€éŒ„å™¨ <span id="user-display" class="text-sm font-normal text-blue-500 ml-2"></span></h1>
            </div>
            <div class="flex items-center gap-2">
                <button id="undoButton" class="bg-slate-100 hover:bg-slate-200 px-4 py-2 rounded-xl text-sm font-bold transition">ä¸Šä¸€æ­¥</button>
                <button id="redoButton" class="bg-slate-100 hover:bg-slate-200 px-4 py-2 rounded-xl text-sm font-bold transition">ä¸‹ä¸€æ­¥</button>
                <div class="w-px h-6 bg-slate-200 mx-2"></div>
                <button onclick="location.href='portal.html'" class="bg-slate-900 text-white px-6 py-2 rounded-xl text-sm font-bold hover:bg-black shadow-lg transition">è¿”å›é¸å–®</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-3 space-y-4">
                <div class="bg-white p-6 rounded-3xl shadow-sm sticky top-4">
                    <h3 class="font-bold text-slate-700 mb-4 flex justify-between items-center">
                        é¸å–å¡ç‰‡ 
                        <span class="text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-400">å…± <span id="cardCount">0</span> ç¨®</span>
                    </h3>
                    
                    <div id="cardContainer" class="grid grid-cols-3 gap-3 mb-6">
                        </div>

                    <button id="clearAllButton" class="w-full bg-red-50 text-red-500 py-4 rounded-2xl font-bold hover:bg-red-100 transition flex items-center justify-center gap-2">
                        <span>ğŸ—‘ï¸</span> ä¸€éµæ¸…é™¤æ‰€æœ‰ç´€éŒ„
                    </button>
                </div>
            </div>

            <div class="lg:col-span-9 bg-white p-8 rounded-[2rem] shadow-sm space-y-10">
                <section>
                    <p class="grid-label uppercase">3 x 2 æ¨¡å¼ (6æ ¼)</p>
                    <div id="grid3x2" class="grid grid-cols-3 gap-4"></div>
                </section>

                <section>
                    <p class="grid-label uppercase">4 x 3 æ¨¡å¼ (12æ ¼)</p>
                    <div id="grid4x3" class="grid grid-cols-4 gap-4"></div>
                </section>

                <section>
                    <p class="grid-label uppercase">4 x 4 æ¨¡å¼ (16æ ¼)</p>
                    <div id="grid4x4" class="grid grid-cols-4 gap-4"></div>
                </section>

                <section>
                    <p class="grid-label uppercase">5 x 4 æ¨¡å¼ (20æ ¼)</p>
                    <div id="grid5x4" class="grid grid-cols-5 gap-4"></div>
                </section>
            </div>
        </div>
    </div>

    <script>
        // --- 1. åœ–ç‰‡è³‡æ–™å€ï¼šè«‹åœ¨æ­¤è£œé½Šä½ çš„åœ–ç‰‡ URL ---
        const cardData = [
          { name: "ç´«ç‰", url: "https://i.postimg.cc/RhYxh9M7/zi-yu.jpg" },
            { name: "å ‡æ›¸", url: "https://i.postimg.cc/rsH2sc8t/jin-shu.jpg" },
            { name: "æ‰é¬¼å¸«", url: "https://i.postimg.cc/Y00wtjww/zhuo-gui-shi.jpg" },
            { name: "å°å¸«å¦¹", url: "https://i.postimg.cc/cJ7WmVm4/xiao-shi-mei.jpg" },
            { name: "é¦¬æ¹˜è˜­", url: "https://i.postimg.cc/T1sv1GR1/ma-xiang-lan.jpg" },
            { name: "ç‰›éƒ", url: "https://i.postimg.cc/9MWhNJ8r/niu-lang.jpg" },
            { name: "èŠ±éƒ", url: "https://i.postimg.cc/85tS8M9w/hua-lang.jpg" },
            { name: "é‡‡è©©å®˜", url: "https://i.postimg.cc/3NNH3WQb/cai-shi-guan.jpg" },
            { name: "è‘£å°å®›", url: "https://i.postimg.cc/SQ1hDLWN/dong-xiao-wan.jpg" },
            { name: "ç²¾è¡›", url: "https://i.postimg.cc/ZYsSVPrd/jing-wei.jpg" },
            { name: "ç¹”å¥³", url: "https://i.postimg.cc/SQ1hDLW9/zhi-nu.jpg" },
            { name: "èŠ±è—å¸«", url: "https://i.postimg.cc/fLBN4mp6/hua-yi-shi.jpg" },
            { name: "æé¦™å›", url: "https://i.postimg.cc/hjSB3pyb/li-xiang-jun.jpg" },
            { name: "å°è´è¶", url: "https://i.postimg.cc/mDbs68XB/xiao-hu-die.jpg" },
            { name: "æ‰‹å·¥å°‘å¥³", url: "https://i.postimg.cc/HxpgPBZW/shou-gong-shao-nu.jpg" },
            { name: "åç‰äº¬", url: "https://i.postimg.cc/PxtjF23d/bian-yu-jing.jpg" },
            { name: "ç‹åå©¦å¥½", url: "https://i.postimg.cc/B6q0wMYP/wang-hou-fu-hao.jpg" },
            { name: "å°é¹¿å¥³", url: "https://i.postimg.cc/qRkTZjbr/xiao-lu-nu.jpg" },
            { name: "å«¦å¨¥", url: "https://i.postimg.cc/y6pHvhFg/chang-e.jpg" },
            { name: "æ–°å¨˜ä¹‹å¦¹", url: "https://i.postimg.cc/FFC4DbjN/xin-niang-zhi-mei.jpg" },
            { name: "ç‹å¦–æŒæ«ƒ", url: "https://i.postimg.cc/fLBN4mpt/hu-yao-zhang-gui.jpg" },
            { name: "å¥³é­ƒ", url: "https://i.postimg.cc/43vG5r5f/nu-ba.jpg" },
            { name: "æ–°å¨˜", url: "https://i.postimg.cc/PJ7nJhty/xin-niang.jpg" },
            { name: "éˆå¤œè²“å¥³", url: "https://i.postimg.cc/NfywVy4M/ling-ye-mao-nu.jpg" },
            { name: "å¡—å±±æ°", url: "https://i.postimg.cc/mknWkRbS/tu-shan-shi.jpg" },
            { name: "å¯‡ç™½é–€", url: "https://i.postimg.cc/6qPxqw9R/kou-bai-men.jpg" },
            { name: "è‹—ç–†è–å¥³", url: "https://i.postimg.cc/4yyTXnRD/miao-jiang-sheng-nu.jpg" },
            { name: "é¦´é·¹å°‘å¥³", url: "https://i.postimg.cc/WpYvXmMD/xun-ying-shao-nu.jpg" },
            { name: "å°æœ¨åŒ ", url: "https://i.postimg.cc/LskSTrTH/xiao-mu-jiang.jpg" },
            { name: "é¦´é¦¬å¸«", url: "https://i.postimg.cc/wx4p05h3/xun-ma-shi.jpg" },
            { name: "é©›ä½¿", url: "https://i.postimg.cc/7Ptkm1g0/yi-shi.jpg" },
            { name: "æ•å¿«", url: "https://i.postimg.cc/L55MmhM9/bu-kuai.jpg" },
            { name: "è¥¿æ¹–èˆ¹å­ƒ", url: "https://i.postimg.cc/4dJgFBLc/xi-hu-chuan-niang.jpg" },
            { name: "è’é‡éˆ´è˜­", url: "https://i.postimg.cc/MHLJHxWK/huang-ye-ling-lan.jpg" },
            { name: "å¤åœ‹å…¬ä¸»", url: "https://i.postimg.cc/vBQsS3qV/gu-guo-gong-zhu.jpg" }

        ];

        let selectedCardUrl = null;
        let history = [];
        let historyIndex = -1;

        // --- 2. åˆå§‹åŒ–èˆ‡æ¬Šé™æª¢æŸ¥ ---
        window.onload = function() {
            const sessionRaw = sessionStorage.getItem('gameData');
            if (!sessionRaw) { location.href = "index.html"; return; }
            const data = JSON.parse(sessionRaw);
            document.getElementById('user-display').innerText = `@${data.user.name}`;
            document.getElementById('auth-guard').style.display = 'none';

            initGame();
        };

        function initGame() {
            document.getElementById('cardCount').textContent = cardData.length;
            
            // ç”Ÿæˆé¸æ“‡æŒ‰éˆ•
            const container = document.getElementById('cardContainer');
            cardData.forEach(card => {
                const div = document.createElement('div');
                div.className = "card-slot p-1 border-2";
                div.innerHTML = `<img src="${card.url}" title="${card.name}">`;
                div.onclick = () => {
                    selectedCardUrl = card.url;
                    container.querySelectorAll('.card-slot').forEach(el => el.classList.remove('selected-btn'));
                    div.classList.add('selected-btn');
                };
                container.appendChild(div);
            });

            // ç”Ÿæˆå„å€‹å®®æ ¼
            createGrid('grid3x2', 6);
            createGrid('grid4x3', 12);
            createGrid('grid4x4', 16);
            createGrid('grid5x4', 20);

            saveState(); // åˆå§‹ç‹€æ…‹
        }

        function createGrid(elementId, count) {
            const grid = document.getElementById(elementId);
            for (let i = 0; i < count; i++) {
                const slot = document.createElement('div');
                slot.className = "card-slot";
                slot.onclick = () => {
                    if (selectedCardUrl) {
                        slot.innerHTML = `<img src="${selectedCardUrl}">`;
                    } else {
                        slot.innerHTML = "";
                    }
                    saveState();
                };
                grid.appendChild(slot);
            }
        }

        // --- 3. æ ¸å¿ƒé‚è¼¯ï¼šä¸Šä¸€æ­¥/ä¸‹ä¸€æ­¥/æ¸…é™¤ ---
        function saveState() {
            const state = [];
            document.querySelectorAll('.lg:col-span-9 .card-slot').forEach(slot => {
                state.push(slot.innerHTML);
            });
            
            // ç æ‰ç•¶å‰ç´¢å¼•ä¹‹å¾Œçš„ç´€éŒ„ï¼ˆè™•ç†åœ¨å›æº¯æ™‚åˆç•«æ–°åœ–çš„æƒ…æ³ï¼‰
            history = history.slice(0, historyIndex + 1);
            history.push(state);
            historyIndex++;
        }

        document.getElementById('undoButton').onclick = () => {
            if (historyIndex > 0) {
                historyIndex--;
                applyState(history[historyIndex]);
            }
        };

        document.getElementById('redoButton').onclick = () => {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                applyState(history[historyIndex]);
            }
        };

        function applyState(state) {
            const slots = document.querySelectorAll('.lg:col-span-9 .card-slot');
            state.forEach((html, i) => {
                slots[i].innerHTML = html;
            });
        }

        document.getElementById('clearAllButton').onclick = () => {
            if (confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å®®æ ¼ç´€éŒ„å—ï¼Ÿ")) {
                document.querySelectorAll('.lg:col-span-9 .card-slot').forEach(slot => slot.innerHTML = "");
                saveState();
            }
        };
    </script>
</body>
</html>
