<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§æŒæ«ƒå·¥å…·ç®± - ç¿»ç‰Œå·¥å…·</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --soft-bg: #fdfaf6;
            --soft-blue: #b9d8eb;
            --soft-green: #cfe1b9;
            --soft-pink: #f4cccc;
            --m-bg: #fdfcfb;
            /* å¥—ç”¨åœ“æ½¤å­—é«” */
            --m-font: "Noto Sans JP", "Microsoft JhengHei", sans-serif;
        }

        body, html { 
            height: 100vh; overflow: hidden; 
            font-family: var(--m-font); 
            background: var(--m-bg); 
            color: #5a5a5a; 
        }
        
        .layout-container { display: grid; grid-template-columns: 140px 1fr 480px; height: 100vh; }

        #mainScrollArea {
            overflow-y: auto;
            padding: 15px 15px 180px 15px;
            height: 100%;
            scrollbar-width: none;
        }
        #mainScrollArea::-webkit-scrollbar { display: none; }

        .card-slot { 
            border: 2px dashed #e2e8f0; border-radius: 12px; aspect-ratio: 1/1; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; background: #fff; transition: all 0.3s;
            overflow: hidden; padding: 2px;
        }
        .card-slot img { width: 100%; height: 100%; object-fit: contain; }

        .btn-action {
            border: 3px solid #fff;
            border-radius: 35px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 900;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 0px rgba(0,0,0,0.05);
            cursor: pointer;
        }

        #undoButton { background: var(--soft-blue); color: #5d7e93; }
        #redoButton { background: var(--soft-green); color: #6e8354; }
        #clearAllButton { background: var(--soft-pink); color: #9c6c6c; }

        .card-grid-container { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            gap: 4px; 
            padding: 8px; 
        }

        .card-btn {
            aspect-ratio: 1/1; border-radius: 8px; background: white; border: 2px solid #f1f1f1;
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }
        .card-btn img { width: 100%; height: 100%; object-fit: contain; }
        .card-btn.active { border-color: #f6ad55; border-width: 3px; background: var(--soft-bg); }

        /* --- æ‰‹æ©Ÿç‰ˆæµ®çª—æŒ‰éˆ•ä¿®æ­£å€ --- */
        #mobileTrigger {
            position: fixed; bottom: 100px; right: 20px; width: 80px; height: 80px;
            background: #cd94b0; color: white; border-radius: 50%; z-index: 45;
            box-shadow: 0 8px 20px rgba(205, 148, 176, 0.4);
            display: none; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            border: 4px solid #fff;
            /* ç§»é™¤åŸæœ¬çš„ line-height é¿å…æ“ å£“ï¼Œæ”¹ç”¨ flex ä½ˆå±€æ§åˆ¶ */
        }
        #mobileTrigger .main-text { 
            font-size: 30px; 
            letter-spacing: 2px; 
            font-weight: 900;
            display: block;
            margin-bottom: -2px; /* é€éè² å€¼å¾®èª¿æ¶ˆé™¤å­—é«”å…§å»ºçš„åº•éƒ¨ç•™ç™½ */
        }
        #mobileTrigger .sub-text { 
            font-size: 11px; 
            opacity: 0.95; 
            font-weight: 700;
            display: block;
            margin-top: 0px; /* å¦‚æœé‚„æ˜¯è¦ºå¾—å¤ªæ“ ï¼Œå¯ä»¥æŠŠé€™è£¡æ”¹æˆ 2px */
        }

        @media (max-width: 768px) {
            .layout-container { grid-template-columns: 1fr; }
            #rightPanel { display: none !important; }
            #mobileTrigger { display: flex !important; }
            #leftPanel { 
                position: fixed; bottom: 0; left: 0; width: 100%; height: 80px; 
                flex-direction: row !important; padding: 12px; z-index: 50;
                background: white; border-top: 3px solid #f1f1f1; border-radius: 30px 30px 0 0;
            }
            #leftPanel button { font-size: 16px; border-radius: 20px; }
        }
    </style>
</head>
<body>

    <div class="layout-container">
        <div id="leftPanel" class="bg-white border-r flex flex-col p-4 gap-4 shadow-sm z-10">
            <button onclick="location.href='portal.html'" class="py-3 bg-slate-500 text-white rounded-[25px] font-black text-lg hover:bg-slate-600 transition-colors">ğŸ  è¿”å›</button>
            <div class="h-[2px] bg-slate-100 hidden md:block"></div>
            <button id="undoButton" class="btn-action flex-[2]">â†©ï¸å›é€€</button>
            <button id="redoButton" class="btn-action flex-[2]">â†ªï¸é‡åš</button>
            <button id="clearAllButton" class="btn-action flex-1">ğŸ—‘ï¸æ¸…é™¤</button>
        </div>

        <div id="mainScrollArea">
            <div class="max-w-xl mx-auto space-y-8">
                <section>
                    <p class="text-sm font-black text-slate-300 mb-2 px-2 tracking-widest text-center">è¼ªæ¬¡1-2 (3 x 2)</p>
                    <div id="grid3x2" class="grid grid-cols-3 gap-1 bg-white/60 p-1 rounded-2xl" style="aspect-ratio: 3/2;"></div>
                </section>
                <section>
                    <p class="text-sm font-black text-slate-300 mb-2 px-2 tracking-widest text-center">è¼ªæ¬¡3-5 (4 x 3)</p>
                    <div id="grid4x3" class="grid grid-cols-4 gap-1 bg-white/60 p-1 rounded-2xl" style="aspect-ratio: 4/3;"></div>
                </section>
                <section>
                    <p class="text-sm font-black text-slate-300 mb-2 px-2 tracking-widest text-center">è¼ªæ¬¡6-8 (4 x 4)</p>
                    <div id="grid4x4" class="grid grid-cols-4 gap-1 bg-white/60 p-1 rounded-2xl" style="aspect-ratio: 1/1;"></div>
                </section>
                <section>
                    <p class="text-sm font-black text-slate-300 mb-2 px-2 tracking-widest text-center">è¼ªæ¬¡9-10 (5 x 4)</p>
                    <div id="grid5x4" class="grid grid-cols-5 gap-1 bg-white/60 p-1 rounded-2xl" style="aspect-ratio: 5/4;"></div>
                </section>
            </div>
        </div>

        <div id="rightPanel" class="bg-white border-l p-4 flex flex-col overflow-hidden">
            <h2 class="text-xl font-black text-slate-700 mb-4 px-2 italic">ğŸ´ èŠ±ç‰Œåº«</h2>
            <div id="cardMenu" class="card-grid-container"></div>
            <div id="activeName" class="mt-4 p-3 bg-slate-50 text-slate-400 font-black rounded-2xl text-center border-2 border-slate-100">è«‹é¸å–ç‰Œé¢</div>
        </div>
    </div>

    <div id="mobileDraggable" style="position:fixed; top:10%; right:20px; width:350px; background:white; border-radius:25px; box-shadow:0 20px 50px rgba(0,0,0,0.2); z-index:100; display:none; flex-direction:column; border:3px solid #f1f1f1;">
        <div class="drag-handle" style="padding:15px; background:var(--soft-blue); color:white; border-radius:22px 22px 0 0; cursor:move; font-weight:bold; display:flex; justify-content:space-between;">
            <span>ç¿»ç‰Œé¸å–®</span>
            <button onclick="toggleMobileMenu()" class="font-bold">âœ•</button>
        </div>
        <div id="mobileCardMenu" class="card-grid-container" style="overflow:visible;"></div>
        <div id="mobileActiveName" class="py-3 text-center text-sm font-black text-slate-400 bg-slate-50 rounded-b-[22px]">æœªé¸å–</div>
    </div>

    <button id="mobileTrigger" onclick="toggleMobileMenu()">
        <span class="main-text">ç‰Œ</span>
        <span class="sub-text">Menu</span>
    </button>

    <div id="clearConfirmModal" class="fixed inset-0 bg-black/40 z-[1000] hidden items-center justify-center backdrop-blur-sm">
        <div class="bg-white p-8 rounded-[35px] w-[85%] max-w-[340px] text-center shadow-2xl">
            <h3 class="text-xl font-black text-slate-800 mb-2">ç¢ºå®šæ¸…é™¤å—ï¼Ÿ</h3>
            <p class="text-sm text-slate-400 mb-6">ç´€éŒ„æ¸…ç©ºå¾Œä¸å¯å›é€€å–”ï¼</p>
            <div class="flex items-center justify-center gap-2 mb-6 font-bold text-slate-500">
                <input type="checkbox" id="skipConfirmCheck" class="w-5 h-5 accent-pink-500"> 
                <label for="skipConfirmCheck">ä¸å†è©¢å•</label>
            </div>
            <div class="flex gap-4">
                <button onclick="closeClearModal(false)" class="flex-1 py-3 bg-slate-100 rounded-full font-black text-slate-500">å–æ¶ˆ</button>
                <button onclick="closeClearModal(true)" class="flex-1 py-3 bg-pink-300 text-white rounded-full font-black shadow-lg">æ¸…ç©º</button>
            </div>
        </div>
    </div>

    <script>
        // --- æ­¤éƒ¨åˆ†ä¿æŒä¸è®Š ---
        const cardData = [
            { name: "ç´«ç‰", img: "https://i.postimg.cc/RhYxh9M7/zi-yu.jpg" },
            { name: "å ‡æ›¸", img: "https://i.postimg.cc/rsH2sc8t/jin-shu.jpg" },
            { name: "æ‰é¬¼å¸«", img: "https://i.postimg.cc/Y00wtjww/zhuo-gui-shi.jpg" },
            { name: "å°å¸«å¦¹", img: "https://i.postimg.cc/cJ7WmVm4/xiao-shi-mei.jpg" },
            { name: "é¦¬æ¹˜è˜­", img: "https://i.postimg.cc/T1sv1GR1/ma-xiang-lan.jpg" },
            { name: "ç‰›éƒ", img: "https://i.postimg.cc/9MWhNJ8r/niu-lang.jpg" },
            { name: "èŠ±éƒ", img: "https://i.postimg.cc/85tS8M9w/hua-lang.jpg" },
            { name: "é‡‡è©©å®˜", img: "https://i.postimg.cc/3NNH3WQb/cai-shi-guan.jpg" },
            { name: "è‘£å°å®›", img: "https://i.postimg.cc/SQ1hDLWN/dong-xiao-wan.jpg" },
            { name: "ç²¾è¡›", img: "https://i.postimg.cc/ZYsSVPrd/jing-wei.jpg" },
            { name: "ç¹”å¥³", img: "https://i.postimg.cc/SQ1hDLW9/zhi-nu.jpg" },
            { name: "èŠ±è—å¸«", img: "https://i.postimg.cc/fLBN4mp6/hua-yi-shi.jpg" },
            { name: "æé¦™å›", img: "https://i.postimg.cc/hjSB3pyb/li-xiang-jun.jpg" },
            { name: "å°è´è¶", img: "https://i.postimg.cc/mDbs68XB/xiao-hu-die.jpg" },
            { name: "æ‰‹å·¥å°‘å¥³", img: "https://i.postimg.cc/HxpgPBZW/shou-gong-shao-nu.jpg" },
            { name: "åç‰äº¬", img: "https://i.postimg.cc/PxtjF23d/bian-yu-jing.jpg" },
            { name: "ç‹åå©¦å¥½", img: "https://i.postimg.cc/B6q0wMYP/wang-hou-fu-hao.jpg" },
            { name: "å°é¹¿å¥³", img: "https://i.postimg.cc/qRkTZjbr/xiao-lu-nu.jpg" },
            { name: "å«¦å¨¥", img: "https://i.postimg.cc/y6pHvhFg/chang-e.jpg" },
            { name: "æ–°å¨˜ä¹‹å¦¹", img: "https://i.postimg.cc/FFC4DbjN/xin-niang-zhi-mei.jpg" },
            { name: "ç‹å¦–æŒæ«ƒ", img: "https://i.postimg.cc/fLBN4mpt/hu-yao-zhang-gui.jpg" },
            { name: "å¥³é­ƒ", img: "https://i.postimg.cc/43vG5r5f/nu-ba.jpg" },
            { name: "æ–°å¨˜", img: "https://i.postimg.cc/PJ7nJhty/xin-niang.jpg" },
            { name: "éˆå¤œè²“å¥³", img: "https://i.postimg.cc/NfywVy4M/ling-ye-mao-nu.jpg" },
            { name: "å¡—å±±æ°", img: "https://i.postimg.cc/mknWkRbS/tu-shan-shi.jpg" },
            { name: "å¯‡ç™½é–€", img: "https://i.postimg.cc/6qPxqw9R/kou-bai-men.jpg" },
            { name: "è‹—ç–†è–å¥³", img: "https://i.postimg.cc/4yyTXnRD/miao-jiang-sheng-nu.jpg" },
            { name: "é¦´é·¹å°‘å¥³", img: "https://i.postimg.cc/WpYvXmMD/xun-ying-shao-nu.jpg" },
            { name: "å°æœ¨åŒ ", img: "https://i.postimg.cc/LskSTrTH/xiao-mu-jiang.jpg" },
            { name: "é¦´é¦¬å¸«", img: "https://i.postimg.cc/wx4p05h3/xun-ma-shi.jpg" },
            { name: "é©›ä½¿", img: "https://i.postimg.cc/7Ptkm1g0/yi-shi.jpg" },
            { name: "æ•å¿«", img: "https://i.postimg.cc/L55MmhM9/bu-kuai.jpg" },
            { name: "è¥¿æ¹–èˆ¹å­ƒ", img: "https://i.postimg.cc/4dJgFBLc/xi-hu-chuan-niang.jpg" },
            { name: "è’é‡éˆ´è˜­", img: "https://i.postimg.cc/MHLJHxWK/huang-ye-ling-lan.jpg" },
            { name: "å¤åœ‹å…¬ä¸»", img: "https://i.postimg.cc/vBQsS3qV/gu-guo-gong-zhu.jpg" }
        ];

        let currentSelected = null;
        let history = [];
        let historyIndex = -1;

        window.onload = () => {
            // åµæ¸¬é‡æ–°æ•´ç†é€»è¾‘
            if (performance.getEntriesByType("navigation")[0]?.type === 'reload') {
                sessionStorage.removeItem('skipClearConfirm');
            }
            renderMenus();
            initGrids();
            loadSavedState();
            setupDraggable();
        };

        function renderMenus() {
            const pcMenu = document.getElementById('cardMenu');
            const mbMenu = document.getElementById('mobileCardMenu');
            cardData.forEach(card => {
                const btn = document.createElement('div');
                btn.className = 'card-btn';
                btn.innerHTML = `<img src="${card.img}">`;
                btn.onclick = (e) => {
                    e.stopPropagation();
                    currentSelected = card;
                    document.getElementById('activeName').innerText = card.name;
                    document.getElementById('mobileActiveName').innerText = card.name;
                    document.querySelectorAll('.card-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                };
                pcMenu.appendChild(btn);
                const mBtn = btn.cloneNode(true);
                mBtn.onclick = btn.onclick;
                mbMenu.appendChild(mBtn);
            });
        }

        function initGrids() {
            const configs = { 'grid3x2':6, 'grid4x3':12, 'grid4x4':16, 'grid5x4':20 };
            for (let id in configs) {
                const container = document.getElementById(id);
                for (let i = 0; i < configs[id]; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'card-slot';
                    slot.onclick = () => {
                        slot.innerHTML = currentSelected ? `<img src="${currentSelected.img}">` : '';
                        saveState();
                    };
                    container.appendChild(slot);
                }
            }
        }

        function saveState() {
            const state = Array.from(document.querySelectorAll('.card-slot')).map(s => s.innerHTML);
            history = history.slice(0, historyIndex + 1);
            history.push(state);
            historyIndex++;
            localStorage.setItem('flipGameData', JSON.stringify(state));
        }

        function loadSavedState() {
            const saved = localStorage.getItem('flipGameData');
            if (saved) {
                const state = JSON.parse(saved);
                applyState(state);
                history = [state];
                historyIndex = 0;
            } else {
                saveState();
            }
        }

        document.getElementById('clearAllButton').onclick = () => {
            const skipStored = sessionStorage.getItem('skipClearConfirm');
            if (skipStored === 'true') { performClear(); return; }
            document.getElementById('clearConfirmModal').style.display = 'flex';
        };

        function closeClearModal(confirm) {
            if (confirm) {
                if (document.getElementById('skipConfirmCheck').checked) {
                    sessionStorage.setItem('skipClearConfirm', 'true');
                }
                performClear();
            }
            document.getElementById('clearConfirmModal').style.display = 'none';
        }

        function performClear() {
            document.querySelectorAll('.card-slot').forEach(s => s.innerHTML = '');
            localStorage.removeItem('flipGameData');
            saveState();
        }

        document.getElementById('undoButton').onclick = () => { if (historyIndex > 0) applyState(history[--historyIndex]); };
        document.getElementById('redoButton').onclick = () => { if (historyIndex < history.length - 1) applyState(history[++historyIndex]); };
        
        function applyState(state) {
            const slots = document.querySelectorAll('.card-slot');
            state.forEach((html, i) => { if(slots[i]) slots[i].innerHTML = html; });
            localStorage.setItem('flipGameData', JSON.stringify(state));
        }

        function toggleMobileMenu() {
            const m = document.getElementById('mobileDraggable');
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }

        function setupDraggable() {
            const el = document.getElementById('mobileDraggable');
            const handle = el.querySelector('.drag-handle');
            let posX = 0, posY = 0, startX = 0, startY = 0;
            const dragStart = (e) => {
                const event = e.type === 'touchstart' ? e.touches[0] : e;
                startX = event.clientX; startY = event.clientY;
                document.addEventListener('touchmove', dragMove, {passive: false});
                document.addEventListener('mousemove', dragMove);
                document.addEventListener('touchend', dragEnd);
                document.addEventListener('mouseup', dragEnd);
            };
            const dragMove = (e) => {
                const event = e.type === 'touchmove' ? e.touches[0] : e;
                posX = startX - event.clientX; posY = startY - event.clientY;
                startX = event.clientX; startY = event.clientY;
                el.style.top = (el.offsetTop - posY) + "px";
                el.style.left = (el.offsetLeft - posX) + "px";
                el.style.transform = "none";
            };
            const dragEnd = () => {
                document.removeEventListener('touchmove', dragMove);
                document.removeEventListener('mousemove', dragMove);
            };
            handle.addEventListener('touchstart', dragStart);
            handle.addEventListener('mousedown', dragStart);
        }
    </script>
</body>
</html>



