<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§æŒæ«ƒç¿»ç‰Œå·¥å…· - çµ‚æ¥µç²¾ç°¡ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html { height: 100vh; overflow: hidden; font-family: sans-serif; background: #e2e8f0; }
        
        /* æ¡Œé¢ç‰ˆä½ˆå±€ï¼šå·¦(120pxç²¾ç°¡) ä¸­(1fr) å³(380px) */
        .layout-container {
            display: grid;
            grid-template-columns: 120px 1fr 380px;
            height: 100vh;
        }

        /* æ»¾å‹•å€åŸŸå„ªåŒ– */
        #mainScrollArea {
            overflow-y: auto;
            padding: 15px 15px 150px 15px; /* å¢åŠ åº•éƒ¨ç•™ç™½ */
            height: 100%;
            -webkit-overflow-scrolling: touch;
        }

        .card-slot { 
            border: 1px dashed #94a3b8; border-radius: 4px; aspect-ratio: 1/1; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; background: #fff;
        }
        .card-slot img { max-width: 95%; max-height: 95%; }

        .card-btn {
            border: 1px solid #cbd5e1; border-radius: 4px; background: white; 
            cursor: pointer; transition: transform 0.1s; display: flex; align-items: center; justify-content: center;
        }
        .card-btn.active { border: 2px solid #6366f1; background: #eef2ff; }

        /* --- æ‰‹æ©Ÿç‰ˆ RWD --- */
        @media (max-width: 768px) {
            .layout-container { grid-template-columns: 1fr; }
            #rightPanel { display: none; }
            #leftPanel { 
                position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; 
                flex-direction: row !important; padding: 5px 10px; z-index: 50;
                background: white; border-top: 2px solid #cbd5e1;
            }
            #leftPanel button { font-size: 11px; padding: 5px; height: 45px; border-radius: 8px; }
            .grid-label { font-size: 11px; }
        }

        /* æ‰‹æ©Ÿæµ®å‹• 6x6 è¦–çª—ï¼šåŠ å…¥ touch-action é˜²æ­¢é é¢æ»¾å‹•å¹²æ“¾æ‹–å‹• */
        #mobileDraggable {
            position: fixed; top: 15%; left: 50%; transform: translateX(-50%); 
            width: 280px; background: white; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 100; display: none; flex-direction: column;
            border: 1px solid #4f46e5;
            touch-action: none; /* é‡è¦ï¼šé˜²æ­¢æ‹–å‹•æ™‚è§¸ç™¼æ‰‹æ©ŸåŸç”Ÿæ»‘å‹• */
        }
        .drag-handle { 
            padding: 8px 12px; background: #4f46e5; color: white; cursor: move; 
            border-radius: 11px 11px 0 0; font-size: 12px; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        #mobileCardMenu {
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; padding: 6px;
        }
        #mobileCardMenu .card-btn { aspect-ratio: 1/1; }

        /* æµ®å‹•æŒ‰éˆ•ç¸®å°ä¸¦é¿é–‹ä¸»è·¯å¾‘ */
        #mobileTrigger {
            position: fixed; bottom: 80px; right: 15px; width: 50px; height: 50px;
            background: rgba(79, 70, 229, 0.8); border-radius: 50%; z-index: 45;
            display: flex; align-items: center; justify-content: center; font-size: 20px;
        }
    </style>
</head>
<body>

    <div class="layout-container">
        
        <div id="leftPanel" class="bg-white border-r flex flex-col p-2 gap-2 shadow-sm z-10">
            <button onclick="location.href='portal.html'" class="py-2 bg-slate-800 text-white rounded-lg font-bold text-xs">ğŸ  è¿”å›</button>
            <div class="hidden md:block h-[1px] bg-slate-200"></div>
            <button id="undoButton" class="flex-1 border border-slate-300 rounded-lg hover:bg-slate-50">â†©ï¸ ä¸Šä¸€æ­¥</button>
            <button id="redoButton" class="flex-1 border border-slate-300 rounded-lg hover:bg-slate-50">â†ªï¸ ä¸‹ä¸€æ­¥</button>
            <button id="clearAllButton" class="flex-1 bg-red-50 text-red-600 border border-red-200 rounded-lg font-bold">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>

        <div id="mainScrollArea">
            <div class="max-w-xl mx-auto space-y-6">
                <section>
                    <p class="grid-label text-slate-500 font-bold mb-1">3 x 2</p>
                    <div id="grid3x2" class="grid grid-cols-3 gap-1 bg-white p-1.5 rounded-lg shadow-sm" style="aspect-ratio: 3/2;"></div>
                </section>
                <section>
                    <p class="grid-label text-slate-500 font-bold mb-1">4 x 3</p>
                    <div id="grid4x3" class="grid grid-cols-4 gap-1 bg-white p-1.5 rounded-lg shadow-sm" style="aspect-ratio: 4/3;"></div>
                </section>
                <section>
                    <p class="grid-label text-slate-500 font-bold mb-1">4 x 4</p>
                    <div id="grid4x4" class="grid grid-cols-4 gap-1 bg-white p-1.5 rounded-lg shadow-sm" style="aspect-ratio: 1/1;"></div>
                </section>
                <section>
                    <p class="grid-label text-slate-500 font-bold mb-1">5 x 4</p>
                    <div id="grid5x4" class="grid grid-cols-5 gap-1 bg-white p-1.5 rounded-lg shadow-sm" style="aspect-ratio: 5/4;"></div>
                </section>
            </div>
        </div>

        <div id="rightPanel" class="bg-white border-l p-3 flex flex-col overflow-hidden">
            <p class="text-xs font-bold text-slate-400 mb-2 uppercase">Cards Library</p>
            <div id="cardMenu" class="grid grid-cols-6 gap-1.5 overflow-y-auto pr-1"></div>
            <div id="activeName" class="mt-3 p-2 bg-indigo-50 text-indigo-700 text-sm font-bold rounded-lg text-center">è«‹é»é¸ç‰Œé¢</div>
        </div>

    </div>

    <div id="mobileDraggable">
        <div class="drag-handle">
            <span>ç‰Œé¢é¸å–® (6x6)</span>
            <button onclick="toggleMobileMenu()" class="text-lg">âœ•</button>
        </div>
        <div id="mobileCardMenu"></div>
        <div id="mobileActiveName" class="py-1 text-center text-[10px] font-bold text-indigo-500 bg-slate-50">æœªé¸æ“‡</div>
    </div>

    <button id="mobileTrigger" class="md:hidden text-white shadow-lg" onclick="toggleMobileMenu()">ğŸ®</button>

    <script>
        // --- æ ¸å¿ƒæ•¸æ“šèˆ‡åŸæœ¬ flipping.html ä¿æŒä¸€è‡´ ---
        const cardData = [];
        for(let i=1; i<=35; i++){ 
            cardData.push({id:`c${i}`, name:`ç‰©å“${i}`, img:`https://placehold.co/60x60?text=${i}`}); 
        }

        let currentSelected = null;
        let history = [];
        let historyIndex = -1;

        window.onload = () => {
            renderMenus();
            initGrids();
            saveState();
            setupDraggable();
        };

        function renderMenus() {
            const pcMenu = document.getElementById('cardMenu');
            const mbMenu = document.getElementById('mobileCardMenu');
            cardData.forEach(card => {
                const btn = document.createElement('div');
                btn.className = 'card-btn';
                btn.innerHTML = `<img src="${card.img}" class="w-full h-full object-contain p-1">`;
                btn.onclick = () => {
                    currentSelected = card;
                    document.getElementById('activeName').innerText = card.name;
                    document.getElementById('mobileActiveName').innerText = card.name;
                    document.querySelectorAll('.card-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                };
                pcMenu.appendChild(btn);
                const mBtn = btn.cloneNode(true);
                mBtn.onclick = btn.onclick;
                mbMenu.appendChild(mBtn);
            });
        }

        function initGrids() {
            const configs = { 'grid3x2':6, 'grid4x3':12, 'grid4x4':16, 'grid5x4':20 };
            for (let id in configs) {
                const container = document.getElementById(id);
                for (let i = 0; i < configs[id]; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'card-slot';
                    slot.onclick = () => {
                        slot.innerHTML = currentSelected ? `<img src="${currentSelected.img}">` : '';
                        saveState();
                    };
                    container.appendChild(slot);
                }
            }
        }

        function saveState() {
            const state = Array.from(document.querySelectorAll('.card-slot')).map(s => s.innerHTML);
            history = history.slice(0, historyIndex + 1);
            history.push(state);
            historyIndex++;
        }

        document.getElementById('undoButton').onclick = () => { if (historyIndex > 0) applyState(history[--historyIndex]); };
        document.getElementById('redoButton').onclick = () => { if (historyIndex < history.length - 1) applyState(history[++historyIndex]); };
        
        function applyState(state) {
            const slots = document.querySelectorAll('.card-slot');
            state.forEach((html, i) => slots[i].innerHTML = html);
        }

        document.getElementById('clearAllButton').onclick = () => {
            if (confirm("æ¸…ç©ºç´€éŒ„ï¼Ÿ")) {
                document.querySelectorAll('.card-slot').forEach(s => s.innerHTML = '');
                saveState();
            }
        };

        function toggleMobileMenu() {
            const m = document.getElementById('mobileDraggable');
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }

        // --- å„ªåŒ–å¾Œçš„æ‹–æ›³é‚è¼¯ (å®Œç¾æ”¯æ´æ‰‹æ©Ÿè§¸æ§) ---
        function setupDraggable() {
            const el = document.getElementById('mobileDraggable');
            const handle = el.querySelector('.drag-handle');
            let posX = 0, posY = 0, startX = 0, startY = 0;

            handle.addEventListener('touchstart', dragStart, {passive: false});
            handle.addEventListener('mousedown', dragStart);

            function dragStart(e) {
                const event = e.type === 'touchstart' ? e.touches[0] : e;
                startX = event.clientX;
                startY = event.clientY;
                document.addEventListener('touchmove', dragMove, {passive: false});
                document.addEventListener('mousemove', dragMove);
                document.addEventListener('touchend', dragEnd);
                document.addEventListener('mouseup', dragEnd);
            }

            function dragMove(e) {
                e.preventDefault(); // ç¦æ­¢é é¢æ»¾å‹•
                const event = e.type === 'touchmove' ? e.touches[0] : e;
                posX = startX - event.clientX;
                posY = startY - event.clientY;
                startX = event.clientX;
                startY = event.clientY;
                el.style.top = (el.offsetTop - posY) + "px";
                el.style.left = (el.offsetLeft - posX) + "px";
                el.style.transform = "none"; // ç§»é™¤åˆå§‹çš„ translateX
            }

            function dragEnd() {
                document.removeEventListener('touchmove', dragMove);
                document.removeEventListener('mousemove', dragMove);
            }
        }
    </script>
</body>
</html>
