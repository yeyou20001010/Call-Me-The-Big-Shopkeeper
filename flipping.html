<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§æŒæ«ƒç¿»ç‰Œå·¥å…· - çµ‚æ¥µä¿®æ­£ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* åŸºç¤æ¨£å¼é–å®š */
        body, html { height: 100vh; overflow: hidden; font-family: sans-serif; }
        
        /* ä½ˆå±€å®¹å™¨ï¼šå·¦(200px) ä¸­(1fr) å³(450px) */
        .layout-container {
            display: grid;
            grid-template-columns: 200px 1fr 450px;
            height: 100vh;
            gap: 0;
            background: #f1f5f9;
        }

        /* ä¸­é–“ç´€éŒ„å€æ»¾å‹• */
        #mainScrollArea {
            overflow-y: auto;
            padding: 20px;
            height: 100%;
        }

        /* ç‰Œé¢ Slot æ¨£å¼ */
        .card-slot { 
            border: 2px dashed #cbd5e1; 
            border-radius: 8px; 
            aspect-ratio: 1/1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            background: #fff; 
            transition: all 0.2s; 
            position: relative; 
        }
        .card-slot:hover { border-color: #6366f1; background: #eef2ff; }
        .card-slot img { max-width: 90%; max-height: 90%; pointer-events: none; }

        /* å³å´ç‰Œé¢æŒ‰éˆ•æ¨£å¼ */
        .card-btn {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 2px;
            cursor: pointer;
            transition: transform 0.1s;
            background: white;
        }
        .card-btn:active { transform: scale(0.9); }
        .card-btn.active { border: 3px solid #6366f1; box-shadow: 0 0 8px rgba(99, 102, 241, 0.4); }

        /* æ‰‹æ©Ÿç‰ˆé©é… (RWD) */
        @media (max-width: 768px) {
            .layout-container { grid-template-columns: 1fr; }
            #rightPanel { display: none; } /* æ‰‹æ©Ÿç‰ˆéš±è—å³å´ï¼Œæ”¹ç”¨æµ®çª— */
            #leftPanel { position: fixed; bottom: 0; width: 100%; height: auto; z-index: 40; flex-direction: row; border-top: 1px solid #ddd; }
        }

        /* æµ®å‹•æ‹–æ›³è¦–çª— (æ‰‹æ©Ÿç‰ˆå°ˆç”¨) */
        #mobileDraggable {
            position: fixed;
            top: 50px;
            right: 10px;
            width: 200px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 100;
            display: none;
            flex-direction: column;
        }
        .drag-handle { padding: 10px; background: #6366f1; color: white; cursor: move; border-top-left-radius: 12px; border-top-right-radius: 12px; }
    </style>
</head>
<body>

    <div class="layout-container">
        
        <div id="leftPanel" class="bg-white border-r flex flex-col p-4 gap-4 shadow-sm z-10">
            <button onclick="location.href='portal.html'" class="w-full py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-black transition">ğŸ  è¿”å›é¸å–®</button>
            
            <div class="mt-4 space-y-2">
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">æ­·å²æ“ä½œ</p>
                <button id="undoButton" class="w-full py-3 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition">â†©ï¸ ä¸Šä¸€æ­¥</button>
                <button id="redoButton" class="w-full py-3 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition">â†ªï¸ ä¸‹ä¸€æ­¥</button>
            </div>

            <div class="mt-auto">
                <button id="clearAllButton" class="w-full py-3 bg-red-50 text-red-600 border border-red-200 rounded-xl font-bold hover:bg-red-600 hover:text-white transition">ğŸ—‘ï¸ å…¨éƒ¨æ¸…é™¤</button>
            </div>
        </div>

        <div id="mainScrollArea" class="space-y-8">
            <div class="max-w-3xl mx-auto">
                <div class="mb-8">
                    <p class="grid-label text-slate-400 font-bold mb-2">3 x 2 æ¯”ä¾‹å€åŸŸ</p>
                    <div id="grid3x2" class="grid grid-cols-3 gap-2 bg-slate-200/50 p-3 rounded-xl" style="aspect-ratio: 3/2;"></div>
                </div>
                <div class="mb-8">
                    <p class="grid-label text-slate-400 font-bold mb-2">4 x 3 æ¯”ä¾‹å€åŸŸ</p>
                    <div id="grid4x3" class="grid grid-cols-4 gap-2 bg-slate-200/50 p-3 rounded-xl" style="aspect-ratio: 4/3;"></div>
                </div>
                <div class="mb-8">
                    <p class="grid-label text-slate-400 font-bold mb-2">4 x 4 æ¯”ä¾‹å€åŸŸ</p>
                    <div id="grid4x4" class="grid grid-cols-4 gap-2 bg-slate-200/50 p-3 rounded-xl" style="aspect-ratio: 1/1;"></div>
                </div>
                <div class="mb-8">
                    <p class="grid-label text-slate-400 font-bold mb-2">5 x 4 æ¯”ä¾‹å€åŸŸ</p>
                    <div id="grid5x4" class="grid grid-cols-5 gap-2 bg-slate-200/50 p-3 rounded-xl" style="aspect-ratio: 5/4;"></div>
                </div>
            </div>
        </div>

        <div id="rightPanel" class="bg-white border-l p-4 flex flex-col h-full overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-black text-slate-700">é¸æ“‡ç‰Œé¢ (6x6)</h3>
                <span class="text-xs bg-indigo-100 text-indigo-600 px-2 py-1 rounded">35 Cards</span>
            </div>
            <div id="cardMenu" class="grid grid-cols-6 gap-2 overflow-y-auto pr-2 custom-scroll">
                </div>
            <div id="selectedDisplay" class="mt-4 p-4 bg-indigo-50 rounded-2xl text-center">
                <p class="text-[10px] text-indigo-400 font-bold uppercase">ç•¶å‰é¸æ“‡</p>
                <p id="activeName" class="text-indigo-700 font-black">è«‹é¸æ“‡å¡ç‰Œ</p>
            </div>
        </div>

    </div>

    <div id="mobileDraggable">
        <div class="drag-handle flex justify-between items-center text-xs">
            <span>é¸æ“‡ç‰Œé¢</span>
            <button onclick="toggleMobileMenu()">âœ•</button>
        </div>
        <div id="mobileCardMenu" class="grid grid-cols-4 gap-2 p-2 max-h-[300px] overflow-y-auto"></div>
    </div>
    <button id="mobileTrigger" class="md:hidden fixed bottom-24 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-2xl z-50 flex items-center justify-center text-2xl" onclick="toggleMobileMenu()">ğŸ®</button>

    <script>
        // 1. ç‰Œé¢æ•¸æ“š (35å¼µ)
        const cardData = [
            { id: "c1", name: "å…ƒå¯¶", img: "https://i.imgur.com/eBfR8N3.png" },
            { id: "c2", name: "å¦‚æ„", img: "https://i.imgur.com/L1LIn9O.png" },
            { id: "c3", name: "ç‡ˆç± ", img: "https://i.imgur.com/xI6mE2E.png" },
            { id: "c4", name: "ç®—ç›¤", img: "https://i.imgur.com/qU3R6wW.png" },
            { id: "c5", name: "æ‰‡å­", img: "https://i.imgur.com/Psh5fJg.png" },
            { id: "c6", name: "èŒ¶å£º", img: "https://i.imgur.com/vHqY7eK.png" },
            { id: "c7", name: "å·è»¸", img: "https://i.imgur.com/6U4M0B8.png" },
            { id: "c8", name: "ç‰ä½©", img: "https://i.imgur.com/M6L2MvE.png" },
            { id: "c9", name: "éŒ¢è¢‹", img: "https://i.imgur.com/fL3x5R3.png" },
            { id: "c10", name: "æ›¸æœ¬", img: "https://i.imgur.com/9C8o4R6.png" },
            // ... é€™è£¡è«‹è£œå…¨æ‚¨çš„ 35 å¼µç‰Œé¢ ...
            // ç‚ºæ±‚ç°¡æ½”ï¼Œæ­¤è™•ç¤ºç¯„å¾ªç’°ç”Ÿæˆ
        ];
        // è£œé½Šæ¸¬è©¦æ•¸æ“šè‡³ 35 å¼µ
        for(let i=11; i<=35; i++){ cardData.push({id:`c${i}`, name:`ç‰©å“${i}`, img:`https://placehold.co/100x100?text=${i}`}); }

        let currentSelected = null;
        let history = [];
        let historyIndex = -1;

        // 2. åˆå§‹åŒ–é é¢
        window.onload = () => {
            renderCardMenu();
            initGrids();
            saveState(); // åˆå§‹ç‹€æ…‹
        };

        function renderCardMenu() {
            const menu = document.getElementById('cardMenu');
            const mobileMenu = document.getElementById('mobileCardMenu');
            cardData.forEach(card => {
                const btn = document.createElement('div');
                btn.className = 'card-btn';
                btn.innerHTML = `<img src="${card.img}" title="${card.name}" class="w-full h-auto">`;
                btn.onclick = () => selectCard(card, btn);
                menu.appendChild(btn);

                // æ‰‹æ©Ÿç‰ˆåŒæ­¥
                const mBtn = btn.cloneNode(true);
                mBtn.onclick = () => { selectCard(card, btn); toggleMobileMenu(); };
                mobileMenu.appendChild(mBtn);
            });
        }

        function selectCard(card, el) {
            document.querySelectorAll('.card-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            currentSelected = card;
            document.getElementById('activeName').innerText = card.name;
        }

        function initGrids() {
            createSlots('grid3x2', 6);
            createSlots('grid4x3', 12);
            createSlots('grid4x4', 16);
            createSlots('grid5x4', 20);
        }

        function createSlots(containerId, count) {
            const container = document.getElementById(containerId);
            for (let i = 0; i < count; i++) {
                const slot = document.createElement('div');
                slot.className = 'card-slot';
                slot.onclick = () => {
                    if (currentSelected) {
                        slot.innerHTML = `<img src="${currentSelected.img}">`;
                        saveState();
                    } else {
                        slot.innerHTML = '';
                        saveState();
                    }
                };
                container.appendChild(slot);
            }
        }

        // 3. æ­·å²ç´€éŒ„ç³»çµ±
        function saveState() {
            const state = Array.from(document.querySelectorAll('.card-slot')).map(s => s.innerHTML);
            if (historyIndex < history.length - 1) history = history.slice(0, historyIndex + 1);
            history.push(state);
            historyIndex++;
        }

        document.getElementById('undoButton').onclick = () => {
            if (historyIndex > 0) {
                historyIndex--;
                applyState(history[historyIndex]);
            }
        };

        document.getElementById('redoButton').onclick = () => {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                applyState(history[historyIndex]);
            }
        };

        function applyState(state) {
            const slots = document.querySelectorAll('.card-slot');
            state.forEach((html, i) => slots[i].innerHTML = html);
        }

        document.getElementById('clearAllButton').onclick = () => {
            if (confirm("æ¸…ç©ºç•¶å‰æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) {
                document.querySelectorAll('.card-slot').forEach(s => s.innerHTML = '');
                saveState();
            }
        };

        // 4. æ‰‹æ©Ÿç‰ˆé‚è¼¯
        function toggleMobileMenu() {
            const m = document.getElementById('mobileDraggable');
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }

        // ç°¡æ˜“æ‹–æ›³
        const drag = document.getElementById('mobileDraggable');
        const handle = drag.querySelector('.drag-handle');
        handle.onmousedown = (e) => {
            let shiftX = e.clientX - drag.getBoundingClientRect().left;
            let shiftY = e.clientY - drag.getBoundingClientRect().top;
            document.onmousemove = (e) => {
                drag.style.left = e.pageX - shiftX + 'px';
                drag.style.top = e.pageY - shiftY + 'px';
            };
            document.onmouseup = () => document.onmousemove = null;
        };
    </script>
</body>
</html>
