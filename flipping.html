<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§æŒæ«ƒå·¥å…·ç®± - ç¿»ç‰Œå·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è«è˜­è¿ªè‰²ç³»å®šç¾© */
        :root {
            --m-green: #a3b18a;
            --m-blue: #9eb3c2;
            --m-pink: #d4a373;
            --m-bg: #f8f9fa;
            --m-card: #ffffff;
            --m-text: #588157;
        }

        body, html { height: 100vh; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; background: var(--m-bg); color: #4a4a4a; }
        
        /* ä½ˆå±€å®¹å™¨ */
        .layout-container {
            display: grid;
            grid-template-columns: 130px 1fr 380px;
            height: 100vh;
        }

        #mainScrollArea {
            overflow-y: auto;
            padding: 20px 20px 160px 20px;
            height: 100%;
            scrollbar-width: none;
        }
        #mainScrollArea::-webkit-scrollbar { display: none; }

        /* è«è˜­è¿ªå¯æ„›é¢¨æ ¼å­ */
        .card-slot { 
            border: 2px dashed #d1d5db; border-radius: 12px; aspect-ratio: 1/1; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; background: #fff; transition: all 0.3s;
        }
        .card-slot:hover { border-color: var(--m-blue); background: #fdfaf6; }
        .card-slot img { width: 92%; height: 92%; object-fit: contain; } /* ç›¡é‡è²¼æ»¿ */

        /* ç‰Œé¢æŒ‰éˆ• */
        .card-btn {
            border-radius: 10px; background: white; border: 2px solid transparent;
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .card-btn.active { border-color: var(--m-pink); transform: scale(0.95); }

        /* --- æ‰‹æ©Ÿç‰ˆ RWD --- */
        @media (max-width: 768px) {
            .layout-container { grid-template-columns: 1fr; }
            #rightPanel { display: none; }
            #leftPanel { 
                position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; 
                flex-direction: row !important; padding: 10px; z-index: 50;
                background: white; border-top: 2px solid #e5e7eb; border-radius: 20px 20px 0 0;
            }
        }

        /* æ‹–æ›³æµ®çª—ï¼šæ‰‹æ©Ÿç‰ˆå°ˆå±¬ */
        #mobileDraggable {
            position: fixed; top: 10%; right: 20px; width: 300px;
            background: white; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            z-index: 100; display: none; flex-direction: column; border: 2px solid #f1f1f1;
            touch-action: none;
        }
        .drag-handle { 
            padding: 12px 18px; background: var(--m-blue); color: white; cursor: move; 
            border-radius: 18px 18px 0 0; font-weight: bold; display: flex; justify-content: space-between;
        }
        
        /* 6x6 é¸å–®ä½ˆå±€ */
        .card-grid-container {
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; padding: 12px;
        }

        /* æµ®çª—æŒ‰éˆ• */
        #mobileTrigger {
            position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px;
            background: var(--m-pink); color: white; border-radius: 50%; z-index: 45;
            box-shadow: 0 8px 20px rgba(212, 163, 115, 0.4);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: black; font-size: 18px; line-height: 1;
        }
        #mobileTrigger span { font-size: 10px; margin-top: 2px; }

        /* è‡ªå®šç¾©å½ˆçª— */
        .custom-alert {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000; display: none;
            align-items: center; justify-content: center;
        }
        .alert-box {
            background: white; padding: 25px; border-radius: 25px; width: 85%; max-width: 320px;
            text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <div class="layout-container">
        <div id="leftPanel" class="bg-white border-r flex flex-col p-4 gap-4 shadow-sm z-10">
            <button onclick="location.href='portal.html'" class="py-3 bg-slate-700 text-white rounded-2xl font-bold">ğŸ  è¿”å›</button>
            <div class="h-[2px] bg-slate-50 hidden md:block"></div>
            <button id="undoButton" class="flex-1 border-2 border-slate-100 rounded-2xl hover:bg-slate-50 font-bold">â†©ï¸ å›é€€</button>
            <button id="redoButton" class="flex-1 border-2 border-slate-100 rounded-2xl hover:bg-slate-50 font-bold">â†ªï¸ é‡åš</button>
            <button id="clearAllButton" class="flex-1 bg-orange-50 text-orange-600 border-2 border-orange-100 rounded-2xl font-black">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>

        <div id="mainScrollArea">
            <div class="max-w-xl mx-auto space-y-12">
                <section>
                    <p class="grid-label px-2">ğŸ“‹ æ¯”ä¾‹ 3 x 2</p>
                    <div id="grid3x2" class="grid grid-cols-3 gap-2 bg-white/50 p-2 rounded-2xl shadow-inner" style="aspect-ratio: 3/2;"></div>
                </section>
                <section>
                    <p class="grid-label px-2">ğŸ“‹ æ¯”ä¾‹ 4 x 3</p>
                    <div id="grid4x3" class="grid grid-cols-4 gap-2 bg-white/50 p-2 rounded-2xl shadow-inner" style="aspect-ratio: 4/3;"></div>
                </section>
                <section>
                    <p class="grid-label px-2">ğŸ“‹ æ¯”ä¾‹ 4 x 4</p>
                    <div id="grid4x4" class="grid grid-cols-4 gap-2 bg-white/50 p-2 rounded-2xl shadow-inner" style="aspect-ratio: 1/1;"></div>
                </section>
                <section>
                    <p class="grid-label px-2">ğŸ“‹ æ¯”ä¾‹ 5 x 4</p>
                    <div id="grid5x4" class="grid grid-cols-5 gap-2 bg-white/50 p-2 rounded-2xl shadow-inner" style="aspect-ratio: 5/4;"></div>
                </section>
            </div>
        </div>

        <div id="rightPanel" class="bg-white border-l p-6 flex flex-col overflow-hidden">
            <h2 class="text-xl font-black text-slate-700 mb-6 flex items-center gap-2">ğŸ® ç‰Œé¢åº« <span class="text-xs bg-slate-100 px-2 py-1 rounded-full">6x6</span></h2>
            <div id="cardMenu" class="card-grid-container overflow-y-auto pr-2"></div>
            <div id="activeName" class="mt-6 p-4 bg-slate-50 text-slate-600 font-bold rounded-2xl text-center border-2 border-dashed">è«‹é»é¸ä¸€å¼µç‰Œ</div>
        </div>
    </div>

    <div id="mobileDraggable">
        <div class="drag-handle">
            <span>ç¿»ç‰Œå·¥å…·ç®±</span>
            <button onclick="toggleMobileMenu()" class="text-xl px-2">âœ•</button>
        </div>
        <div id="mobileCardMenu" class="card-grid-container"></div>
        <div id="mobileActiveName" class="py-2 text-center text-xs font-bold text-slate-400 bg-slate-50 rounded-b-2xl">æœªé¸å–</div>
    </div>

    <button id="mobileTrigger" class="md:hidden" onclick="toggleMobileMenu()">
        <b>ç‰Œ</b><span>MENU</span>
    </button>

    <div id="clearConfirmModal" class="custom-alert">
        <div class="alert-box">
            <h3 class="text-lg font-black mb-2">ç¢ºå®šå…¨éƒ¨æ¸…é™¤ï¼Ÿ</h3>
            <p class="text-sm text-slate-500 mb-4">æ¸…ç©ºå¾Œç„¡æ³•é€éæ’¤éŠ·æ¢å¾©ç´€éŒ„</p>
            <div class="flex items-center justify-center gap-2 mb-6 text-xs text-slate-400">
                <input type="checkbox" id="skipConfirmCheck"> <label for="skipConfirmCheck">ä¸‹æ¬¡ä¸å†é¡¯ç¤º</label>
            </div>
            <div class="flex gap-3">
                <button onclick="closeClearModal(false)" class="flex-1 py-3 bg-slate-100 rounded-xl font-bold">å–æ¶ˆ</button>
                <button onclick="closeClearModal(true)" class="flex-1 py-3 bg-orange-500 text-white rounded-xl font-bold shadow-lg">æ¸…ç©º</button>
            </div>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒæ•¸æ“š (35å¼µ)
        const cardData = [];
        for(let i=1; i<=35; i++){ cardData.push({id:`c${i}`, name:`ç‰©å“${i}`, img:`https://placehold.co/100x100/f1f1f1/888?text=${i}`}); }

        let currentSelected = null;
        let history = [];
        let historyIndex = -1;
        let skipConfirm = false; // å­˜åœ¨å…§å­˜ï¼Œé‡æ•´æœƒå¤±æ•ˆ

        window.onload = () => {
            renderMenus();
            initGrids();
            saveState();
            setupDraggable();
        };

        function renderMenus() {
            const pcMenu = document.getElementById('cardMenu');
            const mbMenu = document.getElementById('mobileCardMenu');
            cardData.forEach(card => {
                const btn = document.createElement('div');
                btn.className = 'card-btn p-1';
                btn.innerHTML = `<img src="${card.img}" class="w-full h-full object-contain">`;
                btn.onclick = (e) => {
                    e.stopPropagation(); // é˜»æ­¢å†’æ³¡ï¼Œç¢ºä¿ä¸è§¸ç™¼è¦–çª—é—œé–‰
                    currentSelected = card;
                    document.getElementById('activeName').innerText = card.name;
                    document.getElementById('mobileActiveName').innerText = card.name;
                    document.querySelectorAll('.card-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                };
                pcMenu.appendChild(btn);
                const mBtn = btn.cloneNode(true);
                mBtn.onclick = btn.onclick;
                mbMenu.appendChild(mBtn);
            });
        }

        function initGrids() {
            const configs = { 'grid3x2':6, 'grid4x3':12, 'grid4x4':16, 'grid5x4':20 };
            for (let id in configs) {
                const container = document.getElementById(id);
                for (let i = 0; i < configs[id]; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'card-slot';
                    slot.onclick = () => {
                        slot.innerHTML = currentSelected ? `<img src="${currentSelected.img}">` : '';
                        saveState();
                    };
                    container.appendChild(slot);
                }
            }
        }

        // æ¸…é™¤é‚è¼¯
        document.getElementById('clearAllButton').onclick = () => {
            if (skipConfirm) { performClear(); return; }
            document.getElementById('clearConfirmModal').style.display = 'flex';
        };

        function closeClearModal(confirm) {
            if (confirm) {
                if (document.getElementById('skipConfirmCheck').checked) skipConfirm = true;
                performClear();
            }
            document.getElementById('clearConfirmModal').style.display = 'none';
        }

        function performClear() {
            document.querySelectorAll('.card-slot').forEach(s => s.innerHTML = '');
            saveState();
        }

        // æ­·å²ç´€éŒ„
        function saveState() {
            const state = Array.from(document.querySelectorAll('.card-slot')).map(s => s.innerHTML);
            history = history.slice(0, historyIndex + 1);
            history.push(state);
            historyIndex++;
        }
        document.getElementById('undoButton').onclick = () => { if (historyIndex > 0) applyState(history[--historyIndex]); };
        document.getElementById('redoButton').onclick = () => { if (historyIndex < history.length - 1) applyState(history[++historyIndex]); };
        function applyState(state) {
            const slots = document.querySelectorAll('.card-slot');
            state.forEach((html, i) => slots[i].innerHTML = html);
        }

        // æ‰‹æ©Ÿé¸å–®åˆ‡æ›
        function toggleMobileMenu() {
            const m = document.getElementById('mobileDraggable');
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }

        // æ‹–æ›³é‚è¼¯ (ä¿®æ­£ç‰ˆ)
        function setupDraggable() {
            const el = document.getElementById('mobileDraggable');
            const handle = el.querySelector('.drag-handle');
            let posX = 0, posY = 0, startX = 0, startY = 0;

            const dragStart = (e) => {
                const event = e.type === 'touchstart' ? e.touches[0] : e;
                startX = event.clientX; startY = event.clientY;
                document.addEventListener('touchmove', dragMove, {passive: false});
                document.addEventListener('mousemove', dragMove);
                document.addEventListener('touchend', dragEnd);
                document.addEventListener('mouseup', dragEnd);
            };

            const dragMove = (e) => {
                const event = e.type === 'touchmove' ? e.touches[0] : e;
                posX = startX - event.clientX; posY = startY - event.clientY;
                startX = event.clientX; startY = event.clientY;
                el.style.top = (el.offsetTop - posY) + "px";
                el.style.left = (el.offsetLeft - posX) + "px";
                el.style.transform = "none";
            };

            const dragEnd = () => {
                document.removeEventListener('touchmove', dragMove);
                document.removeEventListener('mousemove', dragMove);
            };

            handle.addEventListener('touchstart', dragStart);
            handle.addEventListener('mousedown', dragStart);
        }
    </script>
</body>
</html>
